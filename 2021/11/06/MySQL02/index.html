<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false};
  </script>

  <meta name="description" content="本篇讲解的是 DML (数据操作语言)，DDL (数据定义语言)，TCL (传输控制语言)">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL笔记(零二)：DML·DDL·TCL语言">
<meta property="og:url" content="http://yoursite.com/2021/11/06/MySQL02/index.html">
<meta property="og:site_name" content="Cross Code">
<meta property="og:description" content="本篇讲解的是 DML (数据操作语言)，DDL (数据定义语言)，TCL (传输控制语言)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mwchen.oss-cn-hangzhou.aliyuncs.com/MyBlog/MySQL/MySQL02/A3901.png">
<meta property="article:published_time" content="2021-11-06T01:32:26.000Z">
<meta property="article:modified_time" content="2022-11-12T11:56:08.230Z">
<meta property="article:author" content="Minwei Chen">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mwchen.oss-cn-hangzhou.aliyuncs.com/MyBlog/MySQL/MySQL02/A3901.png">

<link rel="canonical" href="http://yoursite.com/2021/11/06/MySQL02/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MySQL笔记(零二)：DML·DDL·TCL语言 | Cross Code</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

  <script type="text/javascript" src="/js/my_js/clicklove.js"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Cross Code</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">There is only one heroism in the world: to see the world as it is and to love it</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80-%E5%89%8D%E8%A8%80"><span class="nav-text">一. 前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C-DML-%E8%AF%AD%E8%A8%80"><span class="nav-text">二. DML 语言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-%E6%8F%92%E5%85%A5%E8%AF%AD%E5%8F%A5"><span class="nav-text">(A) 插入语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E7%BB%8F%E5%85%B8%E6%8F%92%E5%85%A5"><span class="nav-text">(a) 方式一：经典插入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E6%96%B9%E5%BC%8F%E4%BA%8C"><span class="nav-text">(b) 方式二</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%E6%AF%94%E8%BE%83"><span class="nav-text">(c) 两种方式比较</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#B-%E4%BF%AE%E6%94%B9%E8%AF%AD%E5%8F%A5"><span class="nav-text">(B) 修改语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E4%BF%AE%E6%94%B9%E5%8D%95%E8%A1%A8%E7%9A%84%E8%AE%B0%E5%BD%95-%E9%87%8D%E8%A6%81"><span class="nav-text">(a) 修改单表的记录 [重要]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E4%BF%AE%E6%94%B9%E5%A4%9A%E8%A1%A8%E7%9A%84%E8%AE%B0%E5%BD%95-%E8%A1%A5%E5%85%85"><span class="nav-text">(b) 修改多表的记录 [补充]</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-%E5%88%A0%E9%99%A4%E8%AF%AD%E5%8F%A5"><span class="nav-text">(C) 删除语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E8%AF%AD%E6%B3%95"><span class="nav-text">(a) 语法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9Adelete"><span class="nav-text">(1) 方式一：delete</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9Atruncate"><span class="nav-text">(2) 方式二：truncate</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-delete"><span class="nav-text">(b) delete</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%8D%95%E8%A1%A8%E7%9A%84%E5%88%A0%E9%99%A4"><span class="nav-text">(1) 单表的删除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%A4%9A%E8%A1%A8%E7%9A%84%E5%88%A0%E9%99%A4"><span class="nav-text">(2) 多表的删除</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-truncate"><span class="nav-text">(c) truncate</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#D-%E7%BB%83%E4%B9%A0%E9%A2%98"><span class="nav-text">(D) 练习题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89-DDL-%E8%AF%AD%E8%A8%80"><span class="nav-text">三. DDL 语言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-%E5%BA%93%E7%9A%84%E7%AE%A1%E7%90%86"><span class="nav-text">(A) 库的管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E5%BA%93%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">(a) 库的创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E5%BA%93%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="nav-text">(b) 库的修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-%E5%BA%93%E7%9A%84%E5%88%A0%E9%99%A4"><span class="nav-text">(c) 库的删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#B-%E8%A1%A8%E7%9A%84%E7%AE%A1%E7%90%86"><span class="nav-text">(B) 表的管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E8%A1%A8%E7%9A%84%E5%88%9B%E5%BB%BA-%E9%87%8D%E8%A6%81"><span class="nav-text">(a) 表的创建 [重要]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E8%A1%A8%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="nav-text">(b) 表的修改</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BF%AE%E6%94%B9%E5%88%97%E5%90%8D"><span class="nav-text">(1) 修改列名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E4%BF%AE%E6%94%B9%E5%88%97%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%88%96%E7%BA%A6%E6%9D%9F"><span class="nav-text">(2) 修改列的类型或约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E6%B7%BB%E5%8A%A0%E6%96%B0%E5%88%97"><span class="nav-text">(3) 添加新列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%88%A0%E9%99%A4%E5%88%97"><span class="nav-text">(4) 删除列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%90%8D"><span class="nav-text">(5) 修改表名</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-%E8%A1%A8%E7%9A%84%E5%88%A0%E9%99%A4"><span class="nav-text">(c) 表的删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#d-%E8%A1%A8%E7%9A%84%E5%A4%8D%E5%88%B6"><span class="nav-text">(d) 表的复制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-%E7%BB%83%E4%B9%A0"><span class="nav-text">(C) 练习</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#D-%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-text">(D) 常见的数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E6%95%B4%E5%9E%8B"><span class="nav-text">(a) 整型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E5%B0%8F%E6%95%B0"><span class="nav-text">(b) 小数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-%E5%AD%97%E7%AC%A6%E5%9E%8B"><span class="nav-text">(c) 字符型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-char-%E5%92%8C-varchar-%E7%B1%BB%E5%9E%8B-%E9%87%8D%E8%A6%81"><span class="nav-text">(1) char 和 varchar 类型[重要]</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-binary-%E5%92%8C-varbinary-%E7%B1%BB%E5%9E%8B"><span class="nav-text">(2) binary 和 varbinary 类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Enum-%E7%B1%BB%E5%9E%8B"><span class="nav-text">(3) Enum 类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-Set-%E7%B1%BB%E5%9E%8B"><span class="nav-text">(4) Set 类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#d-%E6%97%A5%E6%9C%9F%E5%9E%8B"><span class="nav-text">(d) 日期型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#E-%E5%B8%B8%E8%A7%81%E7%BA%A6%E6%9D%9F"><span class="nav-text">(E) 常见约束</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E5%88%97%E7%BA%A7%E7%BA%A6%E6%9D%9F%E4%B8%8E%E8%A1%A8%E7%BA%A7%E7%BA%A6%E6%9D%9F"><span class="nav-text">(a) 列级约束与表级约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E4%B8%BB%E9%94%AE%E5%92%8C%E5%94%AF%E4%B8%80%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-text">(b) 主键和唯一的对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-%E5%A4%96%E9%94%AE"><span class="nav-text">(c) 外键</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#d-%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%97%B6%E6%B7%BB%E5%8A%A0%E7%BA%A6%E6%9D%9F"><span class="nav-text">(d) 创建表时添加约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e-%E4%BF%AE%E6%94%B9%E8%A1%A8%E6%97%B6%E6%B7%BB%E5%8A%A0%E7%BA%A6%E6%9D%9F"><span class="nav-text">(e) 修改表时添加约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#f-%E4%BF%AE%E6%94%B9%E8%A1%A8%E6%97%B6%E5%88%A0%E9%99%A4%E7%BA%A6%E6%9D%9F"><span class="nav-text">(f) 修改表时删除约束</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#F-%E6%A0%87%E8%AF%86%E5%88%97"><span class="nav-text">(F) 标识列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%97%B6%E8%AE%BE%E7%BD%AE%E6%A0%87%E8%AF%86%E5%88%97"><span class="nav-text">(a) 创建表时设置标识列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E4%BF%AE%E6%94%B9%E8%A1%A8%E6%97%B6%E8%AE%BE%E7%BD%AE%E6%A0%87%E8%AF%86%E5%88%97"><span class="nav-text">(b) 修改表时设置标识列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-%E4%BF%AE%E6%94%B9%E8%A1%A8%E6%97%B6%E5%88%A0%E9%99%A4%E6%A0%87%E8%AF%86%E5%88%97"><span class="nav-text">(c) 修改表时删除标识列</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B-TCL-%E8%AF%AD%E8%A8%80"><span class="nav-text">四. TCL 语言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-%E4%BA%8B%E5%8A%A1"><span class="nav-text">(A) 事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E6%A6%82%E8%BF%B0"><span class="nav-text">(a) 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-text">(b) 存储引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-%E4%BA%8B%E5%8A%A1%E7%9A%84-ACID-%E5%B1%9E%E6%80%A7-%E9%87%8D%E8%A6%81"><span class="nav-text">(c) 事务的 ACID 属性[重要]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#d-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">(d) 事务的创建</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#B-%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1-%E9%87%8D%E8%A6%81"><span class="nav-text">(B) 并发事务[重要]</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E8%A7%A3%E5%86%B3%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98-%E9%87%8D%E8%A6%81"><span class="nav-text">(a) 解决并发问题[重要]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E5%85%B7%E4%BD%93%E6%BC%94%E7%A4%BA"><span class="nav-text">(b) 具体演示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-Mysql-%E4%B8%AD%E8%AE%BE%E7%BD%AE%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-text">(c) Mysql 中设置隔离级别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#d-delete%E5%92%8Ctruncate%E5%9C%A8%E4%BA%8B%E5%8A%A1%E4%BD%BF%E7%94%A8%E6%97%B6%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-text">(d) delete和truncate在事务使用时的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e-savepoint-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">(e) savepoint 的使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-ACID-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">(C) ACID 的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E5%8E%9F%E5%AD%90%E6%80%A7-A-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">(a) 原子性 (A) 的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E6%8C%81%E4%B9%85%E6%80%A7-D-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">(b) 持久性 (D) 的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-%E9%9A%94%E7%A6%BB%E6%80%A7-I-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">(c) 隔离性 (I) 的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#d-%E4%B8%80%E8%87%B4%E6%80%A7-C-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">(d) 一致性 (C) 的实现</span></a></li></ol></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Minwei Chen"
      src="/images/tuoqi.jpg">
  <p class="site-author-name" itemprop="name">Minwei Chen</p>
  <div class="site-description" itemprop="description">Cross the surface, get to the reality. Welcome to Cross Code!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">45</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/AltriaChen" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AltriaChen" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:mwchennju@foxmail.com" title="E-Mail → mailto:mwchennju@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/11/06/MySQL02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/tuoqi.jpg">
      <meta itemprop="name" content="Minwei Chen">
      <meta itemprop="description" content="Cross the surface, get to the reality. Welcome to Cross Code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cross Code">
    </span>

    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL笔记(零二)：DML·DDL·TCL语言
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-06 09:32:26" itemprop="dateCreated datePublished" datetime="2021-11-06T09:32:26+08:00">2021-11-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-12 19:56:08" itemprop="dateModified" datetime="2022-11-12T19:56:08+08:00">2022-11-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>本篇讲解的是 DML (数据操作语言)，DDL (数据定义语言)，TCL (传输控制语言)</p>
<a id="more"></a>

<h1 id="一-前言"><a href="#一-前言" class="headerlink" title="一. 前言"></a>一. 前言</h1><p><strong>语言分类</strong></p>
<ul>
<li>DDL (Data Definition Language)：数据定义语言，用来定义数据库对象：库，表，列等；<br>create/drop/alter</li>
<li><strong>DML</strong> (Data Manipulation Language)：数据操作语言，用来定义数据库记录 (数据)；<br><strong>insert/update/delete</strong></li>
<li>DCL (Data Control Language)：数据控制语言，用来定义访问权限和安全级别；<br>TCL (Transaction Control Language)</li>
<li><strong>DQL</strong> (Data Query Language)：数据查询语言，用来查询记录 (数据)。<br><strong>select</strong></li>
</ul>
<h1 id="二-DML-语言"><a href="#二-DML-语言" class="headerlink" title="二. DML 语言"></a>二. DML 语言</h1><p>数据操作语言</p>
<ul>
<li>插入：insert</li>
<li>修改：update</li>
<li>删除：delete</li>
</ul>
<h2 id="A-插入语句"><a href="#A-插入语句" class="headerlink" title="(A) 插入语句"></a>(A) 插入语句</h2><h3 id="a-方式一：经典插入"><a href="#a-方式一：经典插入" class="headerlink" title="(a) 方式一：经典插入"></a>(a) 方式一：经典插入</h3><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into 表名(列名,…)   </span><br><span class="line">values(值1,…),(值2,…),…;</span><br></pre></td></tr></table></figure>

<p>(1) 插入的值的类型要与列的类型一致或兼容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO beauty(id,NAME,sex,borndate,phone,photo,boyfriend_id)    </span><br><span class="line">VALUES(13,&#39;唐艺昕&#39;,&#39;女&#39;,&#39;1990-4-23&#39;,&#39;18988888888&#39;,NULL,2);</span><br></pre></td></tr></table></figure>

<p>如果插入数据是 ‘1234’ 也可以插入到 int 列中，可以隐式转换。</p>
<p>(2) 不可以为 null 的列必须插入值，可以为 null 的列如何插入值</p>
<p>方式一：值直接写 null</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO beauty(id,NAME,sex,borndate,phone,photo,boyfriend_id)   </span><br><span class="line">VALUES(13,&#39;唐艺昕&#39;,&#39;女&#39;,&#39;1990-4-23&#39;,&#39;18988888888&#39;,NULL,2);</span><br></pre></td></tr></table></figure>

<p>方式二：列和值均不写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO beauty(id,NAME,sex,borndate,phone,boyfriend_id)   </span><br><span class="line">VALUES(14,&#39;金星&#39;,&#39;女&#39;,&#39;1990-4-23&#39;,&#39;13888888888&#39;,2);</span><br></pre></td></tr></table></figure>

<p>photo 列和值均被省略</p>
<p>(3) 列的顺序可以调换，但要一一对应</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO beauty(NAME,sex,id,phone)  </span><br><span class="line">VALUES(&#39;蒋欣&#39;,&#39;女&#39;,16,&#39;123&#39;);</span><br></pre></td></tr></table></figure>

<p>(4) 列数和值的个数必须一致</p>
<p>(5) 可以省略列名，默认所有列，而且列的顺序和表中的顺序一致</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO beauty   </span><br><span class="line">VALUES(18,&#39;张飞&#39;,&#39;男&#39;,NULL,&#39;1212&#39;,NULL,NULL);</span><br></pre></td></tr></table></figure>

<h3 id="b-方式二"><a href="#b-方式二" class="headerlink" title="(b) 方式二"></a>(b) 方式二</h3><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into 表名</span><br><span class="line">set 列名&#x3D;值,列名&#x3D;值,···</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into beauty</span><br><span class="line">set id&#x3D;19,NAME&#x3D;&#39;刘涛&#39;,phone&#x3D;&#39;9001&#39;;</span><br></pre></td></tr></table></figure>

<h3 id="c-两种方式比较"><a href="#c-两种方式比较" class="headerlink" title="(c) 两种方式比较"></a>(c) 两种方式比较</h3><p>(1) 方式一支持插入多行，方式二不支持</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert into beauty(id,NAME,sex,borndate,phone,photo,boyfriend_id)</span><br><span class="line">values(23,&#39;唐艺昕1&#39;,&#39;女&#39;,&#39;1990-4-23&#39;,&#39;18988888888&#39;,NULL,2)</span><br><span class="line">,(24,&#39;唐艺昕1&#39;,&#39;女&#39;,&#39;1990-4-23&#39;,&#39;18988888888&#39;,NULL,2)</span><br><span class="line">,(25,&#39;唐艺昕1&#39;,&#39;女&#39;,&#39;1990-4-23&#39;,&#39;18988888888&#39;,NULL,2)</span><br></pre></td></tr></table></figure>

<p>在 values 后用逗号隔开，然后加括号写要插入的值。</p>
<p>(2) 方式一支持子查询，方式二不支持</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into beauty(id,NAME,phone)</span><br><span class="line">select 26,&#39;宋茜&#39;,&#39;1832980&#39;;</span><br></pre></td></tr></table></figure>

<p>这样也可以实现插入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert into beauty(id,NAME,phone)</span><br><span class="line">select id,boyname,&#39;1423432&#39;</span><br><span class="line">from boys</span><br><span class="line">where id&lt;3;</span><br></pre></td></tr></table></figure>

<h2 id="B-修改语句"><a href="#B-修改语句" class="headerlink" title="(B) 修改语句"></a>(B) 修改语句</h2><h3 id="a-修改单表的记录-重要"><a href="#a-修改单表的记录-重要" class="headerlink" title="(a) 修改单表的记录 [重要]"></a>(a) 修改单表的记录 [重要]</h3><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update 表名</span><br><span class="line">set 列&#x3D;新值,列&#x3D;新值,···</span><br><span class="line">where 筛选条件;</span><br></pre></td></tr></table></figure>

<p>案例 1：修改 beauty 表中姓唐的女神电话为 13888888888</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update beauty set phone&#x3D;&#39;13888888888&#39;</span><br><span class="line">where name like &#39;唐%&#39;;</span><br></pre></td></tr></table></figure>

<p>案例 2：修改 boys 表中 id 号为 2 的名称为张飞，魅力值为 10</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update boys set boyName&#x3D;&#39;张飞&#39;,userCp&#x3D;10</span><br><span class="line">where id&#x3D;2;</span><br></pre></td></tr></table></figure>

<h3 id="b-修改多表的记录-补充"><a href="#b-修改多表的记录-补充" class="headerlink" title="(b) 修改多表的记录 [补充]"></a>(b) 修改多表的记录 [补充]</h3><p>sql 92 语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">update 表1 别名, 表2 别名</span><br><span class="line">set 列&#x3D;值,···</span><br><span class="line">where 连接条件</span><br><span class="line">and 筛选条件;</span><br></pre></td></tr></table></figure>

<p>sql 99 语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">update 表1 别名</span><br><span class="line">inner&#x2F;left&#x2F;right&#x2F;full join 表2 别名</span><br><span class="line">on 连接条件</span><br><span class="line">set 列&#x3D;值,···</span><br><span class="line">where 筛选条件;</span><br></pre></td></tr></table></figure>

<p>案例 1：修改张无忌的女朋友的手机号为 114</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">update boys bo</span><br><span class="line">inner join beauty b</span><br><span class="line">on bo.&#96;id&#96;&#x3D;b.&#96;boyfriend_id&#96;</span><br><span class="line">set b.&#96;phone&#96;&#x3D;&#39;114&#39;</span><br><span class="line">where bo.&#96;boyName&#96;&#x3D;&#39;张无忌&#39;;</span><br></pre></td></tr></table></figure>

<p>案例 2：修改没有男朋友的女神的男朋友编号都为 2 号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">update boys bo</span><br><span class="line">right join beauty b</span><br><span class="line">on bo.&#96;id&#96;&#x3D;b.&#96;boyfriend_id&#96;</span><br><span class="line">set b.&#96;boyfriend_id&#96;&#x3D;2</span><br><span class="line">where bo.&#96;id&#96; is null;</span><br></pre></td></tr></table></figure>

<p>筛选条件为从表的主键为空</p>
<h2 id="C-删除语句"><a href="#C-删除语句" class="headerlink" title="(C) 删除语句"></a>(C) 删除语句</h2><h3 id="a-语法"><a href="#a-语法" class="headerlink" title="(a) 语法"></a>(a) 语法</h3><h4 id="1-方式一：delete"><a href="#1-方式一：delete" class="headerlink" title="(1) 方式一：delete"></a>(1) 方式一：delete</h4><p>(1) 单表的删除 [重点]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from 表名 [where 筛选条件] [limit 条目数]</span><br></pre></td></tr></table></figure>

<p>筛选条件是可选的，如果不写删除条件，就是删除整个表数据。</p>
<p>(2) 多表的删除 [补充]</p>
<p>sql 92 语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">delete 删除表的别名 [, 表2的别名,···]</span><br><span class="line">from 表1 别名, 表2 别名</span><br><span class="line">where 连接条件</span><br><span class="line">and 筛选条件;</span><br></pre></td></tr></table></figure>

<p>sql 99 语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">delete 表1的别名 [, 表2的别名]</span><br><span class="line">from 表1 别名</span><br><span class="line">inner&#x2F;left&#x2F;right join 表2 别名 on 连接条件</span><br><span class="line">where 筛选条件;</span><br></pre></td></tr></table></figure>

<h4 id="2-方式二：truncate"><a href="#2-方式二：truncate" class="headerlink" title="(2) 方式二：truncate"></a>(2) 方式二：truncate</h4><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate table 表名</span><br></pre></td></tr></table></figure>

<p>清空数据，不能加 where，将表中信息全部删除</p>
<h3 id="b-delete"><a href="#b-delete" class="headerlink" title="(b) delete"></a>(b) delete</h3><h4 id="1-单表的删除"><a href="#1-单表的删除" class="headerlink" title="(1) 单表的删除"></a>(1) 单表的删除</h4><p>案例：删除手机号以 9 结尾的女神信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from beauty where phone like &#39;%9&#39;;</span><br></pre></td></tr></table></figure>

<p>delete 和 from 之间不能加列，删除的是一整行的信息。</p>
<h4 id="2-多表的删除"><a href="#2-多表的删除" class="headerlink" title="(2) 多表的删除"></a>(2) 多表的删除</h4><p>案例 1：删除张无忌的女朋友的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#删除哪个表信息就delete那个表</span><br><span class="line">delete b</span><br><span class="line">from boys bo</span><br><span class="line">inner join beauty b on bo.&#96;id&#96;&#x3D;b.&#96;boyfriend_id&#96;</span><br><span class="line">where bo.&#96;boyName&#96;&#x3D;&#96;张无忌&#96;;</span><br></pre></td></tr></table></figure>

<p>案例 2：删除黄晓明的信息及他女朋友的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">delete bo,b</span><br><span class="line">from beauty b</span><br><span class="line">inner join boys bo on b.&#96;boyfriend_id&#96;&#x3D;bo.&#96;id&#96;</span><br><span class="line">where bo.&#96;boyName&#96;&#x3D;&#39;黄晓明&#39;;</span><br></pre></td></tr></table></figure>

<p>将要删除的表写在 delete 后面。</p>
<h3 id="c-truncate"><a href="#c-truncate" class="headerlink" title="(c) truncate"></a>(c) truncate</h3><p>案例：将魅力值 &gt;100 的男神信息删除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate table boys;</span><br></pre></td></tr></table></figure>

<p>不能加 where 筛选，只能把表全部删除。</p>
<p><strong>两种方式比较 [面试题，重要]</strong></p>
<ol>
<li>delete 可以加 where 条件，truncate 不能加</li>
<li>truncate 删除，效率高一点</li>
<li>加入要删除的表中有自增长列，用<strong>delete</strong>删除后，再插入数据，<strong>自增长列的值从断点开始</strong>；而用<strong>truncate</strong>删除后，再插入数据，<strong>自增长列的值从1</strong>开始</li>
<li><strong>truncate</strong>删除<strong>没有返回值</strong>，<strong>delete</strong>删除<strong>有返回值</strong></li>
<li>truncate删除不能回滚，delete删除可以回滚</li>
</ol>
<h2 id="D-练习题"><a href="#D-练习题" class="headerlink" title="(D) 练习题"></a>(D) 练习题</h2><p>(1) 插入语法的两种方式</p>
<p>方式一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">insert into my_employees</span><br><span class="line">values (1,&#39;patel&#39;,&#39;Ralph&#39;,&#39;Rpatel&#39;,895)</span><br><span class="line">,(2,&#39;Dancs&#39;,&#39;Betty&#39;,&#39;Bdancs&#39;,860)</span><br><span class="line">,(3,&#39;Biri&#39;,&#39;Ben&#39;,&#39;Bbiri&#39;,1100)</span><br><span class="line">,(4,&#39;Newman&#39;,&#39;Chad&#39;,&#39;Cnewman&#39;,750)</span><br><span class="line">,(5,&#39;Ropeburn&#39;,&#39;Audrey&#39;,&#39;Aropebur&#39;,1550);</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">insert into my_employees</span><br><span class="line">select 1,&#39;patel&#39;,&#39;Ralph&#39;,&#39;Rpatel&#39;,895 union</span><br><span class="line">select 2,&#39;Dancs&#39;,&#39;Betty&#39;,&#39;Bdancs&#39;,860 union</span><br><span class="line">select 3,&#39;Biri&#39;,&#39;Ben&#39;,&#39;Bbiri&#39;,1100 union</span><br><span class="line">select 4,&#39;Newman&#39;,&#39;Chad&#39;,&#39;Cnewman&#39;,750 union</span><br><span class="line">select 5,&#39;Ropeburn&#39;,&#39;Audrey&#39;,&#39;Aropebur&#39;,1550;</span><br></pre></td></tr></table></figure>

<p>insert into 后面可以跟 select 语句，利用 union 将多条 select 语句变为一条，最后一个 select 后不用加 union。</p>
<p>(2) 将 3 号员工的 last_name 修改为 “drelxer”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update my_employees</span><br><span class="line">set Last_name&#x3D;&#39;drelxer&#39;</span><br><span class="line">where id&#x3D;3;</span><br></pre></td></tr></table></figure>

<p>(3) 将 userid 为 Bbiri 的 user 表和 my_employees 表的记录全部删除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">delete my,us</span><br><span class="line">from users us</span><br><span class="line">join my_employees my on us.&#96;userid&#96;&#x3D;my.&#96;Userid&#96;</span><br><span class="line">where us.&#96;userid&#96;&#x3D;&#39;Bbiri&#39;;</span><br></pre></td></tr></table></figure>

<p>(4) 检查表所做的修正</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from my_employees;</span><br><span class="line">select * from users;</span><br></pre></td></tr></table></figure>

<h1 id="三-DDL-语言"><a href="#三-DDL-语言" class="headerlink" title="三. DDL 语言"></a>三. DDL 语言</h1><p>数据定义语言，库和表的管理</p>
<ol>
<li>库的管理<br>创建，修改，删除</li>
<li>表的管理<br>创建，修改，删除<br>与数据操作语言区分，这里管理的是表的结构，而不是数据</li>
</ol>
<ul>
<li>创建：create</li>
<li>修改：alter</li>
<li>删除：drop</li>
</ul>
<h2 id="A-库的管理"><a href="#A-库的管理" class="headerlink" title="(A) 库的管理"></a>(A) 库的管理</h2><h3 id="a-库的创建"><a href="#a-库的创建" class="headerlink" title="(a) 库的创建"></a>(a) 库的创建</h3><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database [if not exsits] 库名 [character set 字符集名];</span><br></pre></td></tr></table></figure>

<p>案例：创建库 books</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database books;</span><br></pre></td></tr></table></figure>

<p>但是这样创建完成后，再次执行会报错，采用下面语句提高语句容错性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database if not exists books;</span><br></pre></td></tr></table></figure>

<h3 id="b-库的修改"><a href="#b-库的修改" class="headerlink" title="(b) 库的修改"></a>(b) 库的修改</h3><p><strong>基本不修改</strong></p>
<p>库名不能使用 sql 语句去修改</p>
<p>可以更改库的字符集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter database books character set gbk</span><br></pre></td></tr></table></figure>

<h3 id="c-库的删除"><a href="#c-库的删除" class="headerlink" title="(c) 库的删除"></a>(c) 库的删除</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database if exists books;</span><br></pre></td></tr></table></figure>

<p>存在才删除</p>
<h2 id="B-表的管理"><a href="#B-表的管理" class="headerlink" title="(B) 表的管理"></a>(B) 表的管理</h2><h3 id="a-表的创建-重要"><a href="#a-表的创建-重要" class="headerlink" title="(a) 表的创建 [重要]"></a>(a) 表的创建 [重要]</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table [if not exists] 表名(</span><br><span class="line">列名 列的类型[(长度)约束],</span><br><span class="line">列名 列的类型[(长度)约束],</span><br><span class="line">···</span><br><span class="line">列名 列的类型[(长度)约束]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>案例：创建表 book</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table book(</span><br><span class="line">        id INT, #编号</span><br><span class="line">        bName VARCHAR(20), #书名</span><br><span class="line">        price DOUBLE, #价格</span><br><span class="line">        authorId INT, #作者编号</span><br><span class="line">        publishDate DATETIME #出版日期</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>不同字段用逗号隔开，最后一个不用加逗号。</p>
<h3 id="b-表的修改"><a href="#b-表的修改" class="headerlink" title="(b) 表的修改"></a>(b) 表的修改</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add&#x2F;drop&#x2F;modify&#x2F;change column 列名 [列类型 约束];</span><br></pre></td></tr></table></figure>

<h4 id="1-修改列名"><a href="#1-修改列名" class="headerlink" title="(1) 修改列名"></a>(1) 修改列名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 change column 旧列名 新列名 新列名类型</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table book change column publishDate pubDate DATETIME;</span><br></pre></td></tr></table></figure>

<p>change column 要求加上新的列名和类型。column 可以省略。</p>
<h4 id="2-修改列的类型或约束"><a href="#2-修改列的类型或约束" class="headerlink" title="(2) 修改列的类型或约束"></a>(2) 修改列的类型或约束</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 modify column 列名 新类型 [新约束]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table book modify column pubDate TIMESTAMP [新约束];</span><br></pre></td></tr></table></figure>

<p>用到的为 modify。</p>
<h4 id="3-添加新列"><a href="#3-添加新列" class="headerlink" title="(3) 添加新列"></a>(3) 添加新列</h4><p>默认添加在最后列，可以自己指定位置。在最开头，使用 first，在某个字段后面，使用 after 字段名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add column 列名 类型 [first&#x2F;alter 字段名]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table author add column annual DOUBLE [first&#x2F;after 字段名];</span><br></pre></td></tr></table></figure>

<p>用到的为 add。同样需要加上类型。</p>
<h4 id="4-删除列"><a href="#4-删除列" class="headerlink" title="(4) 删除列"></a>(4) 删除列</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop column 列名</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table book drop column annual;</span><br></pre></td></tr></table></figure>

<p>用到的为 drop，这时候就不需要指定类型了。</p>
<h4 id="5-修改表名"><a href="#5-修改表名" class="headerlink" title="(5) 修改表名"></a>(5) 修改表名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 rename [to] 新表名</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table author rename to book_author;</span><br></pre></td></tr></table></figure>

<h3 id="c-表的删除"><a href="#c-表的删除" class="headerlink" title="(c) 表的删除"></a>(c) 表的删除</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table [if exists] book_author;</span><br></pre></td></tr></table></figure>

<p>通用写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">drop database if exists 旧库名;</span><br><span class="line">create database 新库名;</span><br><span class="line"></span><br><span class="line">drop table if exists 旧库名;</span><br><span class="line">create table 表名();</span><br></pre></td></tr></table></figure>

<h3 id="d-表的复制"><a href="#d-表的复制" class="headerlink" title="(d) 表的复制"></a>(d) 表的复制</h3><p>(1) 仅复制表的结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table 表名 like 旧表</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table copy like author;</span><br></pre></td></tr></table></figure>

<p>没有复制内容。</p>
<p>(2) 复制表的结构+数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table 表名</span><br><span class="line">select 查询列表 from 表 [where 筛选]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table copy2</span><br><span class="line">select * from author;</span><br></pre></td></tr></table></figure>

<p>后面跟 select 查询语句</p>
<p>复制部门数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table copy3</span><br><span class="line">select id,au_name</span><br><span class="line">from author</span><br><span class="line">where nation&#x3D;&#39;中国&#39;;</span><br></pre></td></tr></table></figure>

<p>仅复制某些字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table copy4</span><br><span class="line">select id,au_name</span><br><span class="line">from author</span><br><span class="line">where 0;</span><br></pre></td></tr></table></figure>

<h2 id="C-练习"><a href="#C-练习" class="headerlink" title="(C) 练习"></a>(C) 练习</h2><p>(1) 将其他库中的表信息复制进当前库中的表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table dept2</span><br><span class="line">select &#96;department_id&#96;,&#96;department_name&#96;</span><br><span class="line">from &#96;myemployees&#96;,&#96;departments&#96;;</span><br></pre></td></tr></table></figure>

<p>使用库名.表名来进行调用。利用 create 后面 + select 子查询。</p>
<p>(2) 复制其他库中表的结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table employees2 like &#96;myemployees&#96;.employees;</span><br></pre></td></tr></table></figure>

<p>(3) 删除表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists emp5;</span><br></pre></td></tr></table></figure>

<h2 id="D-常见的数据类型"><a href="#D-常见的数据类型" class="headerlink" title="(D) 常见的数据类型"></a>(D) 常见的数据类型</h2><ul>
<li>数值型<pre><code>整数
小数 (定点数，浮点数)</code></pre>
</li>
<li>字符型<pre><code>较短的文本：char，varchar
较长的文本：text，blob (较长的二进制数据)</code></pre>
</li>
<li>日期型</li>
</ul>
<p><strong>原则</strong></p>
<p>所选择的类型越简单越好，能保存数值的类型越小越好</p>
<h3 id="a-整型"><a href="#a-整型" class="headerlink" title="(a) 整型"></a>(a) 整型</h3><p>分类：</p>
<p>tinyint (1 字节)，smallint (2 字节)，mediumint(3 字节)，int/integer(4 字节)，bigint(8 字节)</p>
<p>特点：</p>
<ol>
<li>如果不设置有符号还是无符号，默认是有符号，如果要设置无符号，加上关键字 unsigned</li>
<li>如果插入的数值超出了整型的范围，会报 out of range 异常，并且插入临界值<br>临界值为对应允许范围内最接近插入值的值。如果 tinyint 的范围是 -128 至 127，插入 -129，存入 -128；插入128，存入 127</li>
<li>如果不设置长度，会有默认长度<br>宽度效果为：如果数据长度没有达到指定长度，则在左方用 0 补齐，需要搭配关键字 <strong>zerofill</strong> 使用，此时整型默认变为<strong>无符号</strong>类型</li>
</ol>
<p>(1) 设置无符号和有符号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table tab_int(</span><br><span class="line">        id INT,</span><br><span class="line">        id2 INT UNSIGNED</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="b-小数"><a href="#b-小数" class="headerlink" title="(b) 小数"></a>(b) 小数</h3><ul>
<li>分类</li>
</ul>
<ol>
<li><p>浮点型</p>
<p>float(M,D) 4 字节</p>
<p>double(M,D) 8 字节</p>
</li>
<li><p>定点型</p>
<p>dec(M,D) M+2 字节，最大取值范围与 double 相同</p>
<p>decimal(M,D)</p>
</li>
</ol>
<ul>
<li>特点</li>
</ul>
<ol>
<li><p>M：整数部位 + 小数部位的总长度</p>
<p>D：小数部位</p>
<p>如果超过范围，则插入临界值</p>
</li>
<li><p>M 和 D 都可以省略</p>
<p>如果是 decimal，则 M 默认是 10，D 默认是 0</p>
<p>如果是 float 和 double，则会根据插入数值的精度来决定精度</p>
</li>
<li><p>定点型的精确度较高，如果要求插入数值的精度较高，如货币运算则考虑使用</p>
</li>
</ol>
<h3 id="c-字符型"><a href="#c-字符型" class="headerlink" title="(c) 字符型"></a>(c) 字符型</h3><p>分类：</p>
<p>较短的文本：char，varchar [必须加单引号!!!]</p>
<p>其他：</p>
<p>binary 和 varbinary 用于保存较短的二进制</p>
<p>enum 用于保存枚举</p>
<p>set 用于保存集合</p>
<p>较长的文本：text，blob (较大的二进制数据)</p>
<p>特点：</p>
<h4 id="1-char-和-varchar-类型-重要"><a href="#1-char-和-varchar-类型-重要" class="headerlink" title="(1) char 和 varchar 类型[重要]"></a>(1) char 和 varchar 类型[重要]</h4><table>
<thead>
<tr>
<th>字符串类型</th>
<th>最多字符数</th>
<th>描述及存储需求</th>
<th>空间耗费</th>
<th>效率</th>
</tr>
</thead>
<tbody><tr>
<td>char(M)</td>
<td>M，可以省略，默认为 1</td>
<td>M为0-255之间的整数</td>
<td>固定长度字符，比较耗费空间</td>
<td>高</td>
</tr>
<tr>
<td>varchar(M)</td>
<td>M，不可省略</td>
<td>M为0-65535之间的整数</td>
<td>可变长度字符，比较节省空间</td>
<td>低</td>
</tr>
</tbody></table>
<p>M 为字符，一个汉字或者一个英文字符均为 1 字符。char 固定长度，代表所有字符均用统一长度存储；varchar 可变长度，代表存储长度随数据具体情况而变化。如果字符长度较为固定，用 char，如性别；如果字符长度变化较大，用 vachar，如姓名。</p>
<h4 id="2-binary-和-varbinary-类型"><a href="#2-binary-和-varbinary-类型" class="headerlink" title="(2) binary 和 varbinary 类型"></a>(2) binary 和 varbinary 类型</h4><p>类似于 char 和 varchar，不同的是它们包含二进制字符串而不包含非二进制字符串</p>
<h4 id="3-Enum-类型"><a href="#3-Enum-类型" class="headerlink" title="(3) Enum 类型"></a>(3) Enum 类型</h4><p>枚举类型，要求插入的值必须属于列表中指定的值之一。如果列表成员为 1-255，则需要 1 个字节存储，如果列表成员为 255-65535，则需要 2 个字节存储，最多需要 65535 个成员！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c1 Enum(&#39;a&#39;,&#39;b&#39;,&#39;c&#39;);</span><br></pre></td></tr></table></figure>

<p>如果插入为对应的大写，保存为小写。如果插入类型不在枚举类型中，插入为空。</p>
<h4 id="4-Set-类型"><a href="#4-Set-类型" class="headerlink" title="(4) Set 类型"></a>(4) Set 类型</h4><p>说明：和 Enum 类型类似，里面可以保存 0-64 个成员。和 Enum 类型最大的区别是：Set 类型一次可以<strong>选取多个成员</strong>，而 Enum 只能选一</p>
<p>根据成员个数不同，存储所占的字节也不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s1 set(&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;);</span><br><span class="line">insert into tab_set values(&#39;a,b,c&#39;)</span><br></pre></td></tr></table></figure>

<p>同样不区分大小写。</p>
<h3 id="d-日期型"><a href="#d-日期型" class="headerlink" title="(d) 日期型"></a>(d) 日期型</h3><p>分类：</p>
<p>date 只保存日期</p>
<p>time 只保存时间</p>
<p>year 只保存年</p>
<p>datetime 保存日期+时间</p>
<p>timestamp 保存日期+时间</p>
<p>特点：</p>
<table>
<thead>
<tr>
<th></th>
<th>字节</th>
<th>范围</th>
<th>时区的影响</th>
</tr>
</thead>
<tbody><tr>
<td>datetime</td>
<td>8</td>
<td>1000-9999</td>
<td>不受</td>
</tr>
<tr>
<td>timestamp</td>
<td>4</td>
<td>1970-2038</td>
<td>受</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>日期和时间类型</th>
<th>字节</th>
<th>最小值</th>
<th>最大值</th>
</tr>
</thead>
<tbody><tr>
<td>date</td>
<td>4</td>
<td>1000-01-01</td>
<td>9999-12-31</td>
</tr>
<tr>
<td>datetime</td>
<td>8</td>
<td>1000-01-01 00:00:00</td>
<td>9999-12-31 23:59:59</td>
</tr>
<tr>
<td>timestam</td>
<td>4</td>
<td>19700101080001</td>
<td>2038 年的某个时刻</td>
</tr>
<tr>
<td>time</td>
<td>3</td>
<td>-838:59:59</td>
<td>838:59:59</td>
</tr>
<tr>
<td>year</td>
<td>1</td>
<td>1901</td>
<td>2155</td>
</tr>
</tbody></table>
<p>重点为 datetime 和 timestam。</p>
<p><strong>datetime 和 timestamp 区别</strong></p>
<ol>
<li><strong>Timestamp</strong>支持的时间<strong>范围较小</strong>，取值范围：19700101080001 至 2038 年的某个时间<br>Datetime 的取值范围：1000-1-1 至 9999-12-31</li>
<li>timestamp 和<strong>实际时区</strong>有关，更能反映<strong>实际的日期</strong>，而 datetime 则只是反映出<strong>插入时的当地时区</strong></li>
<li>timestamp 的属性受 Mysql 版本和 SQLMode 的影响很大</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table tab_date(</span><br><span class="line">        t1 DATETIME,</span><br><span class="line">        t2 TIMESTAMP</span><br><span class="line">);</span><br><span class="line">insert into tab_date values(now(),now());</span><br><span class="line">select * from tab_date;</span><br></pre></td></tr></table></figure>

<p>这时候，timestamp 类型数据存储的时间比 datetime 存储的时间快一个小时，随着时区而变化了。</p>
<h2 id="E-常见约束"><a href="#E-常见约束" class="headerlink" title="(E) 常见约束"></a>(E) 常见约束</h2><p>含义：一种限制，用于限制表中的数据，为了保证表中数据的准确和可靠性</p>
<p>分类：六大约束</p>
<ul>
<li><p>NOT NULL：非空，用于保证该字段的值不能为空</p>
<p>如姓名，学号等</p>
</li>
<li><p>DEFAULT：默认，用于保证该字段有默认值</p>
<p>如性别</p>
</li>
<li><p>PRIMARY KEY：主键，用于保证该字段的值有<strong>唯一性</strong>，且要<strong>非空</strong></p>
<p>如学号，员工编号等，可以多个列组合成一个主键</p>
<p>primary key(id，stuname)，插入值要求不能所有组成主键的列相同</p>
</li>
<li><p>UNIQUE：唯一，用于保证该字段的值具有唯一性，可以为空</p>
<p>如座位号，但<strong>最多只能有一个为空</strong></p>
</li>
<li><p>CHECK：检查约束 [mysql 不支持]</p>
<p>比如年龄，性别</p>
</li>
<li><p>FOREIGN KEY：外键，用于限制两个表的关系，用于保证该字段的值必须来自于主表的关联列的值</p>
<p>在从表中添加外键约束，用于引用主表中某列的值</p>
<p>如专业编号，员工表的部门编号，员工表的工种编号</p>
</li>
</ul>
<p><strong>一个字段可以添加多个约束，用空格隔开，无顺序要求</strong></p>
<p>添加约束的时机：</p>
<ol>
<li>创建表时</li>
<li>修改表时</li>
</ol>
<p>约束的添加分类：</p>
<ol>
<li><p>列级约束</p>
<p>六大约束语法上都支持，但外键约束没有效果</p>
</li>
<li><p>表级约束</p>
<p>除了<strong>非空</strong>，<strong>默认</strong>，其他都支持</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">字段名 字段类型 列级约束,</span><br><span class="line">字段名 字段类型,</span><br><span class="line">表级约束</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="a-列级约束与表级约束"><a href="#a-列级约束与表级约束" class="headerlink" title="(a) 列级约束与表级约束"></a>(a) 列级约束与表级约束</h3><table>
<thead>
<tr>
<th></th>
<th>位置</th>
<th>支持的约束类型</th>
<th>是否可以起约束名</th>
</tr>
</thead>
<tbody><tr>
<td>列级约束</td>
<td>列的后面</td>
<td>语法都支持，但外键没有效果</td>
<td>不可以</td>
</tr>
<tr>
<td>表级约束</td>
<td>所有列下面</td>
<td>默认和非空不支持，其他支持</td>
<td>可以(对主键没有效果)</td>
</tr>
</tbody></table>
<h3 id="b-主键和唯一的对比"><a href="#b-主键和唯一的对比" class="headerlink" title="(b) 主键和唯一的对比"></a>(b) 主键和唯一的对比</h3><table>
<thead>
<tr>
<th></th>
<th>保证唯一性</th>
<th>是否允许为空</th>
<th>一个表中可以有多少个</th>
<th>是否允许组合</th>
</tr>
</thead>
<tbody><tr>
<td>主键</td>
<td>是</td>
<td>否</td>
<td>至多有1个</td>
<td>是，但不推荐</td>
</tr>
<tr>
<td>唯一</td>
<td>是</td>
<td>是，但最多一个为空</td>
<td>可以有多个</td>
<td>是，但不推荐</td>
</tr>
</tbody></table>
<h3 id="c-外键"><a href="#c-外键" class="headerlink" title="(c) 外键"></a>(c) 外键</h3><ol>
<li>要求在从表设置外键关系</li>
<li>从表的外键列的类型和主表的关联列的类型要求一致或兼容，名称无要求</li>
<li>主表的关联列<strong>必须是一个key</strong> (一般是<strong>主键</strong>或唯一)</li>
<li>插入数据时，先插入主表，再插入从表</li>
<li>删除数据时，先删除从表，再删除主表</li>
</ol>
<p>可通过以下两种方式删除主表的记录</p>
<p>方式一：级联删除</p>
<p>一般直接删除主表的信息不行，因为要先删除从表，但加上级联删除后，直接删除主表信息后，从表信息也会被删除。</p>
<p>在添加外键的约束后加上 on delete cascade</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table stuinfo add constraint fk_stu_major foreign key(majorid) references </span><br><span class="line">major(id) on delete cascade;</span><br></pre></td></tr></table></figure>

<p>方式二：级联置空</p>
<p>如果不想删除主表信息时从表信息也被删除，就是用级联置空，主表信息被删除后，从表相应位置信息置空</p>
<p>在添加外键的约束后加上 on delete set null</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table stuinfo add constraint fk_stu_major foreign key(major) references </span><br><span class="line">major(id) on delete set null</span><br></pre></td></tr></table></figure>

<h3 id="d-创建表时添加约束"><a href="#d-创建表时添加约束" class="headerlink" title="(d) 创建表时添加约束"></a>(d) 创建表时添加约束</h3><p>(1) 添加列级约束</p>
<p>语法：</p>
<p>直接在字段名和类型后面追加约束类型即可</p>
<p>只支持：主键，唯一，默认，非空</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table stuinfo(</span><br><span class="line">        id INT PRIMARY KEY,#主键</span><br><span class="line">        stuName VARCHAR(20) NOT NULL,#非空</span><br><span class="line">        gender CHAR(1) CHECK(gender IN (&#39;男&#39;,&#39;女&#39;)),#检查</span><br><span class="line">        seat INT UNIQUE,#唯一</span><br><span class="line">        age INT DEFAULT 18,#默认约束</span><br><span class="line">        majorId INT REFERENCES major(id)#外键</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>外键在列级约束时没有用</strong>。主键，外键，唯一键自动生成索引，使用下面语句查看索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show index from stuinfo;</span><br></pre></td></tr></table></figure>

<p>(2) 添加表级约束</p>
<p>语法：在各个字段的最下面，constraint 约束名可省略</p>
<p>[constraint 约束名] 约束类型 (字段名)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create table stuinfo(</span><br><span class="line">        id INT,</span><br><span class="line">        stuName VARCHAR(20),</span><br><span class="line">        gender CHAR(1),</span><br><span class="line">        seat INT,</span><br><span class="line">        age INT,</span><br><span class="line">        majorId INT,</span><br><span class="line"></span><br><span class="line">        constraint pk primary key(id),#主键</span><br><span class="line">        constraint uk unique(seat),#唯一键</span><br><span class="line">        constraint ck check(gender in (&#39;男&#39;,&#39;女&#39;)),#检查</span><br><span class="line">        constraint fk_stuinfo_major foreign key(majorid) references major(id)#外键</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>主键名是默认的，改了没有效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">外键名一般为 fk_当前表名_主键名</span><br></pre></td></tr></table></figure>

<p>通用写法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists stuinfo(</span><br><span class="line">        id INT primary key,</span><br><span class="line">        stuname VARCHAR(20) not null,</span><br><span class="line">        gender char(1),</span><br><span class="line">        age int default 18,</span><br><span class="line">        seat int unique,</span><br><span class="line">        majorid int,</span><br><span class="line">        constraint fk_stuinfo_major foreign key(majorid) references major(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="e-修改表时添加约束"><a href="#e-修改表时添加约束" class="headerlink" title="(e) 修改表时添加约束"></a>(e) 修改表时添加约束</h3><ul>
<li><p>添加列级约束</p>
<p>alter table 表名 <strong>modify column</strong> 字段名 字段类型 新约束;</p>
</li>
<li><p>添加表级约束</p>
<p>alter table 表名 <strong>add</strong> [constraint 约束名] 约束类型 (字段名) [外键的引用];</p>
</li>
</ul>
<p>(1) 添加非空约束</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table stuinfo modify column stuname varchar(20) not null;</span><br></pre></td></tr></table></figure>

<p>(2) 添加默认约束</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table stuinfo modify column age int default 18;</span><br></pre></td></tr></table></figure>

<p>(3) 添加主键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#1.列级约束</span><br><span class="line">alter table stuinfo modify column id int primary key;</span><br><span class="line">#2.表级约束</span><br><span class="line">alter table stuinfo add primary key(id);</span><br></pre></td></tr></table></figure>

<p>(4) 添加唯一键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#1.列级约束</span><br><span class="line">alter table stuinfo modify column seat int unique;</span><br><span class="line">#2.表级约束</span><br><span class="line">alter table stuinfo add unique(seat);</span><br></pre></td></tr></table></figure>

<p>(5) 添加外键</p>
<p>关键词为 ADD，只有表级约束才有效果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table stuinfo add foreign key(majorid) references major(id);</span><br></pre></td></tr></table></figure>

<h3 id="f-修改表时删除约束"><a href="#f-修改表时删除约束" class="headerlink" title="(f) 修改表时删除约束"></a>(f) 修改表时删除约束</h3><p>(1) 删除非空约束</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table stuinfo modify column stuname varchar(20) null;</span><br></pre></td></tr></table></figure>

<p>(2) 删除默认约束</p>
<p>不加约束即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table stuinfo modify column age int;</span><br></pre></td></tr></table></figure>

<p>(3) 删除主键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table stuinfo drop primary key;</span><br></pre></td></tr></table></figure>

<p>(4) 删除唯一</p>
<p>drop index 唯一键名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table stuinfo drop index seat</span><br></pre></td></tr></table></figure>

<p>(5) 删除外键</p>
<p>drop foreign key 外键名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table stuinfo drop foreign key fk_stuinfo_major;</span><br></pre></td></tr></table></figure>

<h2 id="F-标识列"><a href="#F-标识列" class="headerlink" title="(F) 标识列"></a>(F) 标识列</h2><p>又称为自增长列，关键字为 auto_increament</p>
<p>含义：可以<strong>不用手动地插入值</strong>，系统提供默认的序列值，默认从 1 开始，步长为 1</p>
<p>特点：</p>
<ol>
<li>标识列必须和<strong>key搭配</strong></li>
<li>一个表中<strong>至多</strong>有一个标识列</li>
<li>标识列的类型只能是<strong>数值型</strong></li>
<li>标识列可以通过 SET auto_increment_increment = 2; 设置步长<br>可以通过手动插入值，设置初始值</li>
</ol>
<h3 id="a-创建表时设置标识列"><a href="#a-创建表时设置标识列" class="headerlink" title="(a) 创建表时设置标识列"></a>(a) 创建表时设置标识列</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table tab_identity(</span><br><span class="line">        id int primary key auto_increment,</span><br><span class="line">        name varchar(20)</span><br><span class="line">);</span><br><span class="line">insert into tab_identity values(null,&#39;john&#39;);</span><br></pre></td></tr></table></figure>

<p>可以设置自增长的步长，一般不会改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%auto_increment%&#39;;</span><br><span class="line">set auto_increment_increment&#x3D;2;</span><br></pre></td></tr></table></figure>

<h3 id="b-修改表时设置标识列"><a href="#b-修改表时设置标识列" class="headerlink" title="(b) 修改表时设置标识列"></a>(b) 修改表时设置标识列</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table tab_identity modify id int primary key auto_increment;</span><br></pre></td></tr></table></figure>

<h3 id="c-修改表时删除标识列"><a href="#c-修改表时删除标识列" class="headerlink" title="(c) 修改表时删除标识列"></a>(c) 修改表时删除标识列</h3><p>去掉自增长列标识即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table tab_identity modify id int;</span><br></pre></td></tr></table></figure>

<h1 id="四-TCL-语言"><a href="#四-TCL-语言" class="headerlink" title="四. TCL 语言"></a>四. TCL 语言</h1><p>Transaction Control Language 事务控制语言</p>
<h2 id="A-事务"><a href="#A-事务" class="headerlink" title="(A) 事务"></a>(A) 事务</h2><h3 id="a-概述"><a href="#a-概述" class="headerlink" title="(a) 概述"></a>(a) 概述</h3><p>事务：</p>
<p>一个或一组 sql 语句组成一个执行单元，这个执行单元要么全部执行，要么全部不执行。每个 sql 语句是相互依赖的。整个单独单元作为一个不可分割的整体，如果单元中某条 sql 语句一旦执行失败或产生错误，整个单元将会回滚。所有受到影响的数据将返回到事务开始以前的状态；如果单元中的所有 sql 语句均执行成功，则事务被顺利执行。</p>
<h3 id="b-存储引擎"><a href="#b-存储引擎" class="headerlink" title="(b) 存储引擎"></a>(b) 存储引擎</h3><ol>
<li>概念：在 mysql 中的数据用各种不同的技术存储在文件(或内存)中</li>
<li>通过 show engines; 来查看 mysql 支持的存储引擎</li>
<li>在 mysql 中用的最多的存储引擎有：innodb，myisam，memory 等。其中 innodb 支持事务，而 myisam，memory 等不支持事务</li>
</ol>
<h3 id="c-事务的-ACID-属性-重要"><a href="#c-事务的-ACID-属性-重要" class="headerlink" title="(c) 事务的 ACID 属性[重要]"></a>(c) 事务的 ACID 属性[重要]</h3><p>事务的特性：</p>
<ol>
<li><p><strong>原子性</strong> (Atomicity)</p>
<p>原子性指事务是一个<strong>不可分割</strong>的工作单位，事务中的操作要么都发生，要么都不发生</p>
</li>
<li><p><strong>一致性</strong> (Consistency)</p>
<p>事务必须使数据库从一个一致性状态变换到另外一个一致性状态，保证数据的<strong>可靠性</strong></p>
<p>数据要准确，可靠</p>
</li>
<li><p><strong>隔离性</strong> (Isolation)</p>
<p>事务的隔离性是指一个事务的执行<strong>不能被其他事务干扰</strong>，即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰</p>
</li>
<li><p><strong>持久性</strong> (Durability)</p>
<p>持久性指一个事务一旦被提交，它对数据库中数据的改变就是<strong>永久性</strong>的，接下来的其他操作和数据库故障不应该对其有任何影响</p>
</li>
</ol>
<p>有关 ACID 的理解：</p>
<p>AID，是在数据库层面的特征，即依赖于数据库的具体实现，如 A 依靠数据库的 undo log，I 依靠 MVCC，D 依靠 redo log，而 C 一致性，依靠的是应用层，即开发者。一致性的概念是系统从一个正确的状态迁移到另一个正确的状态，而是否正确，指需要满足预定的约束的状态，而这个状态是根据业务场景由开发者设定的。而 ACID 为通过 AID 来保障 C 一致性，AID 是手段，C 是目的。比如转账系统，一个人有 50 元，给其他人转 100，变成 -50，这个事务执行没有破坏数据库层面的约束，但是破坏了应用层的约束。</p>
<h3 id="d-事务的创建"><a href="#d-事务的创建" class="headerlink" title="(d) 事务的创建"></a>(d) 事务的创建</h3><p><strong>隐式事务</strong>：事务没有明显的开启和结束的标记</p>
<p>比如 insert，update，delete 语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from 表 where id &#x3D; 1;</span><br></pre></td></tr></table></figure>

<p><strong>显式事务</strong>：事务具有明显的开启和结束的标记</p>
<p>前提：必须先设置自动提交功能为禁用</p>
<p>只针对当前会话有效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%autocommit&#39;;</span><br><span class="line">set autocommit&#x3D;0;</span><br></pre></td></tr></table></figure>

<p>步骤 1：开启事务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set autocommit&#x3D;0;</span><br><span class="line">start transaction;#可选的</span><br></pre></td></tr></table></figure>

<p>步骤 2：编写事务中的 sql 语句 (<strong>select insert update delete</strong>)</p>
<p>语句 1；</p>
<p>语句 2；</p>
<p>···</p>
<p>[设置回滚点：</p>
<p>savepoint 回滚点名;]</p>
<p>步骤 3：结束事务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commit;提交事务</span><br><span class="line">rollback;回滚事务</span><br><span class="line">[回滚到指定的地方: rollback to 回滚点名;]</span><br></pre></td></tr></table></figure>

<p>savepoint 结点名; #设置保存点</p>
<p><strong>演示事务的使用步骤</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#1.开启事务</span><br><span class="line">set autocommit&#x3D;0;</span><br><span class="line">start transaction;</span><br><span class="line">#2.编写sql语句</span><br><span class="line">update account set balance &#x3D; 500 where username &#x3D; &#39;张无忌&#39;;</span><br><span class="line">update account set balance &#x3D; 1500 where username &#x3D; &#39;赵敏&#39;;</span><br><span class="line">#3.结束事务</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>

<p>如果使用 commit，可以正常修改数据，如果使用的是 rollback，那么对数据没有影响</p>
<h2 id="B-并发事务-重要"><a href="#B-并发事务-重要" class="headerlink" title="(B) 并发事务[重要]"></a>(B) 并发事务[重要]</h2><p>对于同时运行的<strong>多个事务</strong>，当这些事务访问<strong>数据库中相同的数据</strong>时，如果没有采取必要的隔离机制，就会导致各种并发问题：</p>
<ul>
<li><strong>更新丢失</strong>：多个事务选择同一行，最后的更新会覆盖之前的更新。在提交事务前，不能访问同一文件，可避免。</li>
<li><strong>脏读</strong>：对于两个事务 T1，T2，T1 读取了已经被 T2 <strong>更新</strong>但<strong>还没有提交</strong>的字段，之后若 T2 回滚，T1 读取的内容就是<strong>临时且无效</strong>的</li>
<li><strong>不可重复读</strong>：对于两个事务 T1，T2，T1 读取了一个字段，然后 T2 <strong>更新</strong>了该字段，之后 T1 再次读取同一个字段，<strong>值就不同</strong>了</li>
<li><strong>幻读</strong>：对于两个事务 T1，T2，T1 从一个表中读取了一个字段，然后 T2 在该表中<strong>插入</strong>了一些新的行，之后如果 T1 再次读取同一个表，就会多出几行</li>
</ul>
<p>脏读与幻读相对比，脏读更侧重于字段的<strong>更新</strong>，幻读侧重于行的<strong>插入</strong></p>
<h3 id="a-解决并发问题-重要"><a href="#a-解决并发问题-重要" class="headerlink" title="(a) 解决并发问题[重要]"></a>(a) 解决并发问题[重要]</h3><p><strong>数据库的隔离级别</strong>：数据库系统必须具有隔离并发运行各个事务的能力，是它们不会相互影响，避免各种并发问题</p>
<p>数据库提供的 4 种事务隔离级别</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED (读未提交数据)</td>
<td>允许事务读取未被其他事务提交的变更。<strong>脏读</strong>，<strong>不可重复读和幻读</strong>的问题都会出现</td>
</tr>
<tr>
<td>READ COMMITTED (读已提交数据)</td>
<td>只允许事务读取已经被其他事务提交的变更，可以避免脏读，但<strong>不可重复读和幻读</strong>问题仍可能出现</td>
</tr>
<tr>
<td>REPEATABLE READ (可重复读)</td>
<td>确保事务可以多次从一个字段中读取相同的值，在这个事务持续期间，禁止其他事务对这个字段进行更新，可以避免脏读和不可重复读，但<strong>幻读</strong>的问题仍然存在</td>
</tr>
<tr>
<td>SERIALIZABLE (串行化)</td>
<td>确保事务可以从一个表中读取相同的行，在这个事务持续期间，禁止其他事务对该表执行插入，更新和删除操作，所有并发问题都可以避免，但性能十分低下</td>
</tr>
</tbody></table>
<p>Oracle 支持的 2 种事务级别：<strong>READ COMMITTED</strong>，SERIALIZABLE。Oracle 默认的事务隔离级别为 READ COMMITTED</p>
<p>Mysql 支持 4 种事务级别，Mysql 默认的事务隔离级别为 <strong>REPETABLE READ</strong></p>
<h3 id="b-具体演示"><a href="#b-具体演示" class="headerlink" title="(b) 具体演示"></a>(b) 具体演示</h3><p>查看当前隔离级别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select @@tx_isolation;</span><br><span class="line">8.0后改为 select @@transaction_isolation;</span><br><span class="line">show variables like &#39;tx_isolation&#39;;</span><br></pre></td></tr></table></figure>

<p>将隔离级别设置成最低</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set session transaction isolation level read uncommitted;</span><br></pre></td></tr></table></figure>

<p>如果中文显示为乱码，更改字符集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set names gbk;</span><br></pre></td></tr></table></figure>

<p>这时候如果开启两个事务，一个将表中姓名更改但没有提交，这时候另一个事务去读表中内容，读到了没有提交的内容，当事务 1 回滚，再次读的时候事务 2 仍读到原来的，出现脏读。</p>
<p>当更改事务 1 的隔离级别为读已提交，更改数据但不提交，更改事务 2 的隔离级别为读已提交，查看表中数据，无法看到表格修改的内容。因此脏读被避免。但当事务 1 提交后，事务 2 再查看表中内容，发现两次看的数据不一样，出现不可重复读。</p>
<p>可重复读下：</p>
<p>当更改事务 1 和 2 的隔离级别为可重复读，更改事务 1 的数据但不提交，事务 2 查看表中数据，为未修改前的；当事务 1 提交，事务 2 查看仍是未修改的。只有事务 2 提交后，再次查看才是修改后的。解决了脏读和不可重复读。但当事务 1 要更改所有行数据的名字，还未执行，在此时事务 2 插入了一条数据并 commit 了，这样当事务 1 执行的时候多影响到了事务 2 插入的这一条数据，有幻读出现。只有执行插入语句的事务提交后，事务 1 的更改语句才能执行成功。</p>
<table>
<thead>
<tr>
<th></th>
<th>事务 A</th>
<th>事务 B</th>
</tr>
</thead>
<tbody><tr>
<td>T1</td>
<td>SET autocommit=0;</td>
<td>SET autocommit=0;</td>
</tr>
<tr>
<td>T2</td>
<td>select * from account; 3条</td>
<td></td>
</tr>
<tr>
<td>T3</td>
<td></td>
<td>insert into account values(); 插入一条</td>
</tr>
<tr>
<td>T4</td>
<td></td>
<td>commit</td>
</tr>
<tr>
<td>T5</td>
<td>update account set balance=100; 会影响4条</td>
<td></td>
</tr>
</tbody></table>
<p>在可重复读下，执行以上时间点的操作，可以发现，当事务 A 第一次读取数据，只有 3 条，当事务 B 插入一行数据后，事务 A 再次更新的时候，会影响 4 条数据，出现了幻读。但是如果此时事务 A 去读取数据，仍然只有 3 条。原因是 select 读是快照读，MVCC 解决了快照读的幻读问题。而 update 为当前读，在当前读下仍然会出现幻读情况。</p>
<p>同时，使用 select * from account for update; 这种当前读的 select 也会出现幻读。</p>
<p>当事务 1，2 的隔离级别修改为串行化后，当事务 1，2 均开启，事务 1 要执行 update 操作，事务 2 执行插入语句，但无法执行成功，只有事务 1 提交后，事务 2 才能执行。一次只能执行一个事务。</p>
<p>经过试验，在最高等级下，哪个事务先被开启不重要，如果同时有两个事务被开启，事务 1 要执行插入操作，事务 2 没有执行 sql 语句，此时事务 1 的插入操作可以成功；但一旦事务 2 执行了 sql 语句，插入操作便不能成功，当插入数据的事务没有提交前，其他事务不能进行查询操作。小结：只要其他表使用了 sql 语句查看 or 操作表，修改表的操作就不能被执行；只要有其他事务修改了表，就不能查看表。看了不能改，改了不能看。</p>
<h3 id="c-Mysql-中设置隔离级别"><a href="#c-Mysql-中设置隔离级别" class="headerlink" title="(c) Mysql 中设置隔离级别"></a>(c) Mysql 中设置隔离级别</h3><ul>
<li>每启动一个 mysql 程序，就会获得一个单独的数据库连接，每个数据库连接都有一个全局变量 @@tx_isolation，表示当前的事务隔离级别</li>
<li>查看当前的隔离级别：select @@tx_isolation;</li>
<li>设置当前 mysql 连接的隔离级别<br>set session transaction isolation level <strong>read uncommitted</strong>; 将其替换为需要的级别</li>
<li>设置数据库的全局隔离级别<br>set <strong>global</strong> transaction isolation level <strong>read uncommitted</strong>;</li>
</ul>
<h3 id="d-delete和truncate在事务使用时的区别"><a href="#d-delete和truncate在事务使用时的区别" class="headerlink" title="(d) delete和truncate在事务使用时的区别"></a>(d) delete和truncate在事务使用时的区别</h3><p>delete 和 truncate 是针对数据的操作语言，而不是针对表结构的，要删除表使用 drop table，删除数据使用 delete from 表名和 truncate table 表名。</p>
<p>演示 delete</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set autocommit&#x3D;0;</span><br><span class="line">start transaction;</span><br><span class="line">delete from account;</span><br><span class="line">rollback;</span><br></pre></td></tr></table></figure>

<p>数据并没有被删除。</p>
<p>演示 truncate</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set autocommit&#x3D;0;</span><br><span class="line">start transaction;</span><br><span class="line">truncate table account;</span><br><span class="line">rollback;</span><br></pre></td></tr></table></figure>

<p>这时候数据仍然被删除了，没有回滚。因此 truncate 不支持回滚。</p>
<h3 id="e-savepoint-的使用"><a href="#e-savepoint-的使用" class="headerlink" title="(e) savepoint 的使用"></a>(e) savepoint 的使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set autocommit &#x3D; 0;</span><br><span class="line">start transaction;</span><br><span class="line">delete from account where id &#x3D; 1;</span><br><span class="line">savepoint a; #设置保存点</span><br><span class="line">delete from account where id &#x3D; 3;</span><br><span class="line">rollback to a; #回滚至保存点</span><br></pre></td></tr></table></figure>

<p>savepoint 搭配 rollback 使用，回滚到保存点，因此 id=1 的行被删除，但是 id=3 的行没有。</p>
<h2 id="C-ACID-的实现"><a href="#C-ACID-的实现" class="headerlink" title="(C) ACID 的实现"></a>(C) ACID 的实现</h2><h3 id="a-原子性-A-的实现"><a href="#a-原子性-A-的实现" class="headerlink" title="(a) 原子性 (A) 的实现"></a>(a) 原子性 (A) 的实现</h3><p>原子性为一个事务是不可分割的工作单位，操作要么一起做，要么都不做，若一个 sql 执行失败，已经执行的语句需要回滚。</p>
<p>而原子性的实现依靠的是 undo log (回滚日志)，实现原子性的关键为可以撤销成功执行的 sql 语句。当事务要对数据库进行修改时，InnoDB 生成对应的 undo log，若事务执行失败或调用了 roll back，可以使用 undo log 来将数据修改为回滚前的状态。</p>
<p>undo log 是逻辑日志，记录 sql 执行相关信息，属于存储引擎层。当发生回滚时，InnoDB 根据 undo log 的内容做与之前相反的操作：对 insert，进行 delete；对 delete，进行 insert；对 update，执行相反的 update，将数据改回去。</p>
<h3 id="b-持久性-D-的实现"><a href="#b-持久性-D-的实现" class="headerlink" title="(b) 持久性 (D) 的实现"></a>(b) 持久性 (D) 的实现</h3><p>持久性为事务一旦提交，对数据库的改变应该是永久性的，接下来的其他操作或故障不应该对其有影响。</p>
<p>持久性的实现依靠的是 redo log (重做日志)，与 undo log 回滚日志一样属于 InnoDB 的事务日志。</p>
<p>InnoDB 提供缓存 Buffer Pool，包含磁盘中部分数据页的映射，作为数据库的缓冲，减少 IO 次数。数据库读取数据的逻辑是：先在 Buffer Pool 中读取，若缓冲中没有，从磁盘读取后放入缓冲。当向数据库写数据，先写入缓冲，Buffer Pool 中修改的数据定期刷新到磁盘中(刷脏)。Buffer Pool 的优点是提高了读写效率，但问题是，若 Mysql 宕机，会导致 Buffer Pool 中数据没有刷新到磁盘，数据丢失，持久性也就无法保证。因此 redo log 被引入。</p>
<p>数据修改时，除了在 Buffer Pool 中修改，也会在 redo log 中记录；redo log 默认在事务提交时刷盘，也有每秒刷盘等。Mysql 宕机后，重启时可以读取 redo log 中的数据，对数据库进行恢复。而所有修改先写入 redo log，再更新到 Buffer Pool，这样可以保持持久性。</p>
<p>而 redo log 可以保证持久性的关键是它比刷脏要更快，不然刷脏很快也没有必要使用 redo log，redo log 更快的原因是</p>
<ul>
<li>刷脏是随机 IO，修改数据随机；redo log 是追加操作，为顺序 IO (不用多个地方移动磁头)</li>
<li>刷脏以数据页为单位，MySQL 默认页是 16kb，对页上做小修改要整页写入；redo log 只包含真正需要写入的数据(修改量更少)</li>
</ul>
<h3 id="c-隔离性-I-的实现"><a href="#c-隔离性-I-的实现" class="headerlink" title="(c) 隔离性 (I) 的实现"></a>(c) 隔离性 (I) 的实现</h3><p>隔离性为事务的内部操作与其他事务隔离，并发执行的事务之间不能相互干扰，最严格的隔离性，对应事务隔离级别中的串行化。</p>
<p>主要考虑读与写之间的隔离性</p>
<ul>
<li>事务 A 写操作对事务 B 写操作的影响：锁机制保证</li>
<li>事务 A 写操作对事务 B 读操作的影响：MVCC 保证</li>
</ul>
<p>MyISAM 的锁为表锁，而 InnoDB 为行锁，粒度更小。当事务 A 对一行数据执行写操作时，对相同行执行写操作的事务 B 会被阻塞，直到事务 A 提交。</p>
<p>并发事务会产生脏读，不可重复读和幻读问题，对应的，数据库依靠前面所说的四个隔离级别来消除这些影响，但隔离级别越高，虽然读取问题变少，但性能也变差，一般数据库默认可重复读 (MySQL) 或读已提交 (Oracle)。</p>
<p>而隔离级别解决脏读，不可重复读或幻读，依靠的是 MVCC，即 Multi-Version Concurrency Control，多版本并发事务控制。MVCC 的特点是不同事务读取到的数据可能是不同的(多版本的)，因为读为快照读(读取不是最新的)。最大的优先是读不加锁，因此读写不冲突，并发性能好。InnoDB 实现 MVCC，多个版本的数据可以共存，主要依靠的是数据<strong>隐藏列</strong>(标记位)，<strong>undo log</strong> 和 <strong>Read View</strong> (读视图)。</p>
<p>要实现多版本控制，需要保存有<strong>不同版本的数据</strong>，需要当前版本可以<strong>找到上一个版本的数据</strong>，和判断当前版本<strong>可以看到哪些版本的数据</strong>，分别依靠 undo log，隐藏列与 Read View。</p>
<p>隐藏列中包括</p>
<ul>
<li>最近<strong>修改事务ID</strong></li>
<li><strong>回滚指针</strong>：配合 undo log，指向此记录上一个版本</li>
<li>隐藏的自增 ID</li>
<li>实际还有删除 flag 隐藏字段，记录被更新或删除不是真的删除，而是 flag 变化</li>
</ul>
<p>读取数据时，MySQL 可以判断是否需要回滚并找到所需要的 undo log，从而实现。</p>
<p>对 MVCC 有帮助的是 undo log 中记录了 update 和 delete 的日志，在快照读时有用。</p>
<p>当有新事物对数据进行了修改，新事务会有指针指向旧事务。</p>
<p><img src="https://mwchen.oss-cn-hangzhou.aliyuncs.com/MyBlog/MySQL/MySQL02/A3901.png"></p>
<p>这样 undo log 形成一个单向链表，表头为最新的旧记录，表尾是最早的旧记录。</p>
<p>而 Read View 是在事务进行快照读的时候产生的读视图，维护了活跃事务的 ID (自增，越新事务 ID 越大)，用来判断当前版本的视图可以看到哪个版本的数据。其用来做数据的可见性判断，其可见性算法是，取出要修改的数据的最新记录中的事务 ID，与 Read View 中维护的活跃事务 ID 比较，若不符合可见性，则通过回滚指针找到 undo log 中上一条记录，直到找到符合可见性规则的 (从表头到表尾)。</p>
<p>其判断的逻辑为：在 Read View 中维护了一系列生成时刻事务 ID，其中有最小事务 ID 与已创建最大事务 ID。</p>
<ul>
<li>如果数据中当前事务 ID 小于生成时最小事务 ID，说明此记录是在 Read View 前面就出现了，最新的数据是可以被看到的；若大于等于进入下一个判断</li>
<li>如果当前事务 ID 大于等于已创建最大事务 ID，说明此记录是在 Read View 后才出现的，肯定对当前事务不可见；若小于，进入下一个判断</li>
<li>判断数据中事务 ID 是否仍在活跃事务之中，如果在，代表 Read View 时刻，事务还在活跃，没有 commit，修改的数据当前事务也看不到；如果不在，说明事务在 Read View 前已经 commit 了，修改的结果对当前事务是可见的</li>
</ul>
<p>如果一个数据被删除了，将版本链上的数据复制一份，更新修改事务 ID，然后将标志位更改为 true，如果查询到了已经删除的数据 (flag 为 true)，则不返回数据。</p>
<p>因此可以看出快照读的结果非常依赖于 Read View 生成的时机。</p>
<p>在读已提交下，每个快照读都会生成并获取最新的 Read View，可重复读下同一个事务的第一个快照才生成 Read View，之后快照读取的仍为同一个 Read View。</p>
<p>个人小总结为：若是快照读生成的时机越早，更新的次数越少，越有可能对其他事务修改的数据不可见。</p>
<h3 id="d-一致性-C-的实现"><a href="#d-一致性-C-的实现" class="headerlink" title="(d) 一致性 (C) 的实现"></a>(d) 一致性 (C) 的实现</h3><p>一致性为数据库完整性约束没有被破坏，事务执行的前后数据状态都是合法的。一致性是事务的最终目标，是依靠于原子性，隔离性和持久性来实现的。在数据库层面与应用层层面都需要来保障一致性。</p>
<p>一致性既然是靠 A，D，C 来实现的 (乌兹乌兹乌兹)，为何还要将其单独放出来呢？因为 A，D，C 属于数据库级别的实现，是在数据库的功能下实现的，而一致性属于应用层，如转账的场景，A 现有 10 元，给 B 转了 50 元，A 的余额变为 -40，这个转账过程是符合 ADC 过程的，但是不符合业务规定，即一致性是认为规定的应用层的约定，需要依靠程序 + 业务中某些规定来实现，因此一致性属性是非常重要也需要单独放出来的。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/MySQL/" rel="tag"># MySQL</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/09/14/MySQL01/" rel="prev" title="MySQL笔记(零一)：MySQL简介·DQL语言">
      <i class="fa fa-chevron-left"></i> MySQL笔记(零一)：MySQL简介·DQL语言
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/11/16/MySQL03/" rel="next" title="MySQL笔记(零三)：视图·变量·函数·流程控制">
      MySQL笔记(零三)：视图·变量·函数·流程控制 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Minwei Chen</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/next-boot.js"></script>


  















  

  

  

</body>
</html>
