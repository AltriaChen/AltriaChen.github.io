<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false};
  </script>

  <meta name="description" content="本篇讲解的是视图，变量，函数，以及流程控制结构。除此之外，整理了 MySQL 中常用的一些重要函数，以及讲解了 Java DataBase Connectivity 的应用。">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL笔记(零三)：视图·变量·函数·流程控制">
<meta property="og:url" content="http://yoursite.com/2021/11/16/MySQL03/index.html">
<meta property="og:site_name" content="Cross Code">
<meta property="og:description" content="本篇讲解的是视图，变量，函数，以及流程控制结构。除此之外，整理了 MySQL 中常用的一些重要函数，以及讲解了 Java DataBase Connectivity 的应用。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-11-16T06:25:00.000Z">
<meta property="article:modified_time" content="2021-11-16T06:26:48.000Z">
<meta property="article:author" content="Minwei Chen">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2021/11/16/MySQL03/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MySQL笔记(零三)：视图·变量·函数·流程控制 | Cross Code</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

  <script type="text/javascript" src="/js/my_js/clicklove.js"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Cross Code</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">There is only one heroism in the world: to see the world as it is and to love it</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80-%E8%A7%86%E5%9B%BE"><span class="nav-text">一. 视图</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE"><span class="nav-text">(A) 创建视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#B-%E8%A7%86%E5%9B%BE%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="nav-text">(B) 视图的好处</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-%E8%A7%86%E5%9B%BE%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="nav-text">(C) 视图的修改</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#D-%E8%A7%86%E5%9B%BE%E7%9A%84%E5%88%A0%E9%99%A4"><span class="nav-text">(D) 视图的删除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#E-%E6%9F%A5%E7%9C%8B%E8%A7%86%E5%9B%BE"><span class="nav-text">(E) 查看视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#F-%E8%A7%86%E5%9B%BE%E7%BB%83%E4%B9%A0"><span class="nav-text">(F) 视图练习</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#G-%E8%A7%86%E5%9B%BE%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="nav-text">(G) 视图的更新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#H-%E8%A7%86%E5%9B%BE%E4%B8%8E%E8%A1%A8%E7%9A%84%E6%AF%94%E8%BE%83"><span class="nav-text">(H) 视图与表的比较</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C-%E5%8F%98%E9%87%8F"><span class="nav-text">二. 变量</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="nav-text">(A) 系统变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#B-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="nav-text">(B) 自定义变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E7%94%A8%E6%88%B7%E5%8F%98%E9%87%8F"><span class="nav-text">(a) 用户变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F"><span class="nav-text">(b) 局部变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-%E5%AF%B9%E6%AF%94"><span class="nav-text">(c) 对比</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0"><span class="nav-text">三. 存储过程和函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-text">(A) 存储过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%B0%83%E7%94%A8"><span class="nav-text">(a) 存储过程创建与调用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E8%AF%AD%E6%B3%95"><span class="nav-text">(1) 创建语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%B0%83%E7%94%A8%E8%AF%AD%E6%B3%95"><span class="nav-text">(2) 调用语法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%88%A0%E9%99%A4"><span class="nav-text">(b) 存储过程删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-%E6%9F%A5%E7%9C%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="nav-text">(c) 查看存储过程的信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#d-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%BB%83%E4%B9%A0"><span class="nav-text">(d) 存储过程练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#B-%E5%87%BD%E6%95%B0"><span class="nav-text">(B) 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E5%87%BD%E6%95%B0%E5%88%9B%E5%BB%BA"><span class="nav-text">(a) 函数创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="nav-text">(b) 函数调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-%E6%9F%A5%E7%9C%8B%E5%87%BD%E6%95%B0"><span class="nav-text">(c) 查看函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#d-%E5%88%A0%E9%99%A4%E5%87%BD%E6%95%B0"><span class="nav-text">(d) 删除函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e-%E5%87%BD%E6%95%B0%E7%BB%83%E4%B9%A0"><span class="nav-text">(e) 函数练习</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84"><span class="nav-text">四. 流程控制结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-%E5%88%86%E6%94%AF%E7%BB%93%E6%9E%84"><span class="nav-text">(A) 分支结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-IF-%E5%87%BD%E6%95%B0"><span class="nav-text">(a) IF 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-CASE-%E7%BB%93%E6%9E%84"><span class="nav-text">(b) CASE 结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-IF-%E7%BB%93%E6%9E%84"><span class="nav-text">(c) IF 结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#B-%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84"><span class="nav-text">(B) 循环结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-while"><span class="nav-text">(a) while</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-loop"><span class="nav-text">(b) loop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-repeat"><span class="nav-text">(c) repeat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#d-%E5%BE%AA%E7%8E%AF%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">(d) 循环的使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94-%E9%87%8D%E8%A6%81%E5%87%BD%E6%95%B0"><span class="nav-text">五. 重要函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AD-%E7%89%9B%E5%AE%A2%E7%BD%91%E9%A2%98%E7%9B%AE"><span class="nav-text">六. 牛客网题目</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%83-JDBC"><span class="nav-text">七. JDBC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-Driver-Manager"><span class="nav-text">(A) Driver Manager</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#B-JDBC-%E4%BD%BF%E7%94%A8"><span class="nav-text">(B) JDBC 使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-%E4%BA%8B%E5%8A%A1"><span class="nav-text">(C) 事务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#D-%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="nav-text">(D) 快捷键</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Minwei Chen"
      src="/images/tuoqi.jpg">
  <p class="site-author-name" itemprop="name">Minwei Chen</p>
  <div class="site-description" itemprop="description">Cross the surface, get to the reality. Welcome to Cross Code!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/AltriaChen" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AltriaChen" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:mwchennju@foxmail.com" title="E-Mail → mailto:mwchennju@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/11/16/MySQL03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/tuoqi.jpg">
      <meta itemprop="name" content="Minwei Chen">
      <meta itemprop="description" content="Cross the surface, get to the reality. Welcome to Cross Code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cross Code">
    </span>

    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL笔记(零三)：视图·变量·函数·流程控制
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-11-16 14:25:00 / 修改时间：14:26:48" itemprop="dateCreated datePublished" datetime="2021-11-16T14:25:00+08:00">2021-11-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>本篇讲解的是视图，变量，函数，以及流程控制结构。除此之外，整理了 MySQL 中常用的一些重要函数，以及讲解了 Java DataBase Connectivity 的应用。</p>
<a id="more"></a>

<h1 id="一-视图"><a href="#一-视图" class="headerlink" title="一. 视图"></a>一. 视图</h1><p>含义：虚拟表，和普通表一起使用</p>
<p>MySQL 5.1 版本出现的新特性，行和列的数据来自自定义视图的查询中使用的表，并且是在使用视图时<strong>动态生成</strong>的，<strong>只保存了 sql 逻辑，不保存查询结果</strong></p>
<p>应用场景：</p>
<ul>
<li>多个地方用到<strong>同样的查询结果</strong></li>
<li>该查询结果使用的 sql 语句<strong>较复杂</strong></li>
</ul>
<p>好处：</p>
<ol>
<li>简化了 sql 语句</li>
<li>提高了 sql 的重要性</li>
<li>保护了基表的数据，提高了安全性</li>
</ol>
<p>案例：查询姓张的学生名和专业名</p>
<p>以前的做法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select stuname,majorName</span><br><span class="line">from &#96;stuinfo&#96; s</span><br><span class="line">inner join &#96;major&#96; m on s.&#96;majorID&#96;&#x3D;m.&#96;id&#96;</span><br><span class="line">where stuname like &#39;张%&#39;;</span><br></pre></td></tr></table></figure>

<p>现在可以将常用的语句封装为视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create view v1</span><br><span class="line">as</span><br><span class="line">select stuname,majorName</span><br><span class="line">from &#96;stuinfo&#96; s</span><br><span class="line">inner join &#96;major&#96; m on s.&#96;majorId&#96;&#x3D;m.&#39;id&#39;;</span><br></pre></td></tr></table></figure>

<p>要调用的时候</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from v1 where stuname like &#39;张%&#39;;</span><br></pre></td></tr></table></figure>

<h2 id="A-创建视图"><a href="#A-创建视图" class="headerlink" title="(A) 创建视图"></a>(A) 创建视图</h2><p>语法：</p>
<p>create view 视图名</p>
<p>as</p>
<p>查询语句;</p>
<p>(1) 查询姓名中包含 a 字符的员工名，部门名和工种信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 1.创建</span><br><span class="line">create view myv1</span><br><span class="line">as</span><br><span class="line">select last_name,department_name,job_title</span><br><span class="line">from &#96;employees&#96; e</span><br><span class="line">join &#96;departments&#96; d on e.&#96;department_id&#96;&#x3D;d.&#96;department_id&#96;</span><br><span class="line">join &#96;jobs&#96; j on j.&#96;job_id&#96;&#x3D;e.&#96;job_id&#96;;</span><br><span class="line"># 2.使用</span><br><span class="line">select * from myv1 where last_name like &#39;%a%&#39;;</span><br></pre></td></tr></table></figure>

<p>(2) 查询各部门的平均工资级别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 1.创建视图查看每个部门的平均工资</span><br><span class="line">create view myv2</span><br><span class="line">as</span><br><span class="line">select avg(salary) ag,department_id</span><br><span class="line">from employees</span><br><span class="line">group by department_id;</span><br><span class="line"># 2.使用</span><br><span class="line">select myv2.&#96;ag&#96;,g.grade_level</span><br><span class="line">from myv2</span><br><span class="line">join job_grades g</span><br><span class="line">on myv2.&#96;ag&#96; between g.&#96;lowest_sal&#96; and g.&#96;highest_sal&#96;;</span><br></pre></td></tr></table></figure>

<p>(3) 查询平均工资最低的部门信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 平均工资视图已经被创建</span><br><span class="line">select * from myv2 order by myv2.&#96;ag&#96; asc limit 1;</span><br></pre></td></tr></table></figure>

<p>(4) 查询平均工资最低的部门名和工资</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#创建平均工资最低的部门id表</span><br><span class="line">create view myv3</span><br><span class="line">as</span><br><span class="line">select * from myv2 order by myv2.&#96;ag&#96; asc limit 1;</span><br><span class="line">#将视图与部门表进行连接</span><br><span class="line">select d.*,m.ag</span><br><span class="line">from myv3 m</span><br><span class="line">join departments d</span><br><span class="line">on m.&#96;department_id&#96;&#x3D;d.&#96;department_id&#96;;</span><br></pre></td></tr></table></figure>

<h2 id="B-视图的好处"><a href="#B-视图的好处" class="headerlink" title="(B) 视图的好处"></a>(B) 视图的好处</h2><ul>
<li>重用 sql 语句</li>
<li>简化复杂的 sql 操作，不必知道其细节</li>
<li>保护数据，提高安全性</li>
</ul>
<h2 id="C-视图的修改"><a href="#C-视图的修改" class="headerlink" title="(C) 视图的修改"></a>(C) 视图的修改</h2><p>方式一：</p>
<p>意思为存在就替代，不存在就创建</p>
<p><strong>create or replace</strong> view 视图名</p>
<p>as</p>
<p>查询语句;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create or replace view myv3</span><br><span class="line">as</span><br><span class="line">select avg(salary),job_id</span><br><span class="line">from employees</span><br><span class="line">group by job_id;</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<p>语法：</p>
<p>alter view 视图名</p>
<p>as</p>
<p>查询语句;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter view myv3</span><br><span class="line">as</span><br><span class="line">select * from employees;</span><br></pre></td></tr></table></figure>

<h2 id="D-视图的删除"><a href="#D-视图的删除" class="headerlink" title="(D) 视图的删除"></a>(D) 视图的删除</h2><p>语法：</p>
<p><strong>drop view</strong> 视图名，视图名， ···；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop view myv1,myv2,myv3;</span><br></pre></td></tr></table></figure>

<h2 id="E-查看视图"><a href="#E-查看视图" class="headerlink" title="(E) 查看视图"></a>(E) 查看视图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">desc myv3;</span><br><span class="line">show create view myv3;</span><br></pre></td></tr></table></figure>

<h2 id="F-视图练习"><a href="#F-视图练习" class="headerlink" title="(F) 视图练习"></a>(F) 视图练习</h2><p>(1) 创建视图 emp_v1，要求查询电话号码以 001 开头的员工姓名和工资，邮箱</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create or replace view emp_v1</span><br><span class="line">as</span><br><span class="line">select last_name,salary,email</span><br><span class="line">from employees</span><br><span class="line">where phone_number like &#39;011%&#39;</span><br></pre></td></tr></table></figure>

<p>不能先创建没有 phone 筛选的视图再调用视图筛选，因为视图中没有 phone 这一列。</p>
<p>(2) 创建视图 emp_v2，要求查询部门最高工资高于 12000 的部门信息</p>
<p>之前做法：先得到部门最高工资高于 12000 的工资和编号表，然后和部门表连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select d.*,m.mx</span><br><span class="line">from departments d</span><br><span class="line">join (</span><br><span class="line">        select max(salary) mx,department_id</span><br><span class="line">        from employees</span><br><span class="line">        group by department_id</span><br><span class="line">        having max(salary)&gt;12000</span><br><span class="line">) as m</span><br><span class="line">on d.department_id&#x3D;m.department_id;</span><br></pre></td></tr></table></figure>

<p>视图的做法，先将部门最高工资高于 12000 的工资和编号表作为视图，然后用视图和部门表连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create view emp_v2</span><br><span class="line">as</span><br><span class="line">select max(salary) mx,department_id</span><br><span class="line">from employees</span><br><span class="line">group by department_id</span><br><span class="line">having max(salary)&gt;12000;</span><br><span class="line"></span><br><span class="line">select d.*,emp_v2.mx</span><br><span class="line">from departments d</span><br><span class="line">join emp_v2</span><br><span class="line">on d.department_id&#x3D;emp_v2.department_id;</span><br></pre></td></tr></table></figure>

<h2 id="G-视图的更新"><a href="#G-视图的更新" class="headerlink" title="(G) 视图的更新"></a>(G) 视图的更新</h2><p>对视图的数据更新，而不是结构。一般给视图添加权限，只允许读，不允许写。</p>
<p>视图的可更新性和视图中查询的定义有关系，以下类型的视图是不允许更新的</p>
<ul>
<li>包含以下关键字的 sql 语句：分组函数，distinct，group by，having，union 或者 union all</li>
<li>常量视图</li>
<li>select 中包含子查询</li>
<li>join</li>
<li>from 一个不能更新的视图</li>
<li>where 子句的子查询引用了 from 子句中的表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create or replace view myv1</span><br><span class="line">as</span><br><span class="line">select last_name,email</span><br><span class="line">from employees;</span><br></pre></td></tr></table></figure>

<p>(1) 插入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into myv1 values(&#39;张飞&#39;,&#39;zf@qq.com&#39;);</span><br></pre></td></tr></table></figure>

<p>此时在原始的 employees 表中也插入了数据。</p>
<p>(2) 修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update myv1 set last_name&#x3D;&#39;张无忌&#39; where last_name&#x3D;&#39;张飞&#39;;</span><br></pre></td></tr></table></figure>

<p>原始表依然被更改了</p>
<p>(3) 删除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from myv1 where last_name&#x3D;&#39;张无忌&#39;;</span><br></pre></td></tr></table></figure>

<h2 id="H-视图与表的比较"><a href="#H-视图与表的比较" class="headerlink" title="(H) 视图与表的比较"></a>(H) 视图与表的比较</h2><table>
<thead>
<tr>
<th></th>
<th>创建语法的关键字</th>
<th>是否实际占用物理空间</th>
<th>使用</th>
</tr>
</thead>
<tbody><tr>
<td>视图</td>
<td>create view</td>
<td>只是保存了 sql 逻辑</td>
<td>一般仅用来查</td>
</tr>
<tr>
<td>表</td>
<td>create table</td>
<td>保存了数据</td>
<td>增删改查</td>
</tr>
</tbody></table>
<h1 id="二-变量"><a href="#二-变量" class="headerlink" title="二. 变量"></a>二. 变量</h1><p>系统变量</p>
<ul>
<li><p>全局变量</p>
<p>作用域：服务器每次启动将为所有的全局变量赋初始值，针对于所有的会话(连接)有效，但不能跨重启。</p>
</li>
<li><p>会话变量</p>
<p>作用域：仅仅针对于当前会话(连接)有效</p>
</li>
</ul>
<p>自定义变量</p>
<ul>
<li>用户变量</li>
<li>局部变量</li>
</ul>
<h2 id="A-系统变量"><a href="#A-系统变量" class="headerlink" title="(A) 系统变量"></a>(A) 系统变量</h2><p>说明：变量由系统提供，不是用户定义，属于服务器层面</p>
<p>使用的语法：</p>
<p>(1) 查看所有的系统变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show global variables; #全局变量</span><br><span class="line">show [session] variables; #会话变量</span><br></pre></td></tr></table></figure>

<p>(2) 查看满足条件的部分系统变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global|[session] variables like &#39;%查询字符%&#39;;</span><br></pre></td></tr></table></figure>

<p>(3) 查看指定的某个系统变量的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select @@global.系统变量名;#全局变量</span><br><span class="line">select @@[session.]系统变量名;#会话变量</span><br></pre></td></tr></table></figure>

<p>(4) 为某个系统变量赋值</p>
<p>方式一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global|[session] 系统变量名&#x3D;值;</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set @@global|[session] .系统变量名&#x3D;值;</span><br></pre></td></tr></table></figure>

<p>注意：如果是全局级别，则需要加 global，如果是会话级别，则需要加 session，如果不写，则默认 session</p>
<h2 id="B-自定义变量"><a href="#B-自定义变量" class="headerlink" title="(B) 自定义变量"></a>(B) 自定义变量</h2><p>说明：变量是用户自定义的，不是由系统定义的。</p>
<p>使用步骤：</p>
<p>声明</p>
<p>赋值</p>
<p>使用(查看，比较，运算等)</p>
<h3 id="a-用户变量"><a href="#a-用户变量" class="headerlink" title="(a) 用户变量"></a>(a) 用户变量</h3><p>作用域：针对于当前的会话(连接)有效，同于会话变量的作用域</p>
<p>应用在任何地方，也就是 begin end 里面或者外面</p>
<p>赋值的操作符：= 或 :=</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#1.声明并初始化</span><br><span class="line">set @用户变量名&#x3D;值;或</span><br><span class="line">set @用户变量名:&#x3D;值;或</span><br><span class="line">select @用户变量名:&#x3D;值;</span><br><span class="line">#2.赋值(更新用户变量的值)</span><br><span class="line">方式一:通过 set 或 select</span><br><span class="line">    set @用户变量名&#x3D;值;或</span><br><span class="line">    set @用户变量名:&#x3D;值;或</span><br><span class="line">    select @用户变量名:&#x3D;值;</span><br><span class="line">方式二:通过 select into</span><br><span class="line">    select 字段 into @变量名</span><br><span class="line">    from 表;</span><br><span class="line">#3.使用(查看用户变量的值)</span><br><span class="line">    select @用户变量名;</span><br></pre></td></tr></table></figure>

<h3 id="b-局部变量"><a href="#b-局部变量" class="headerlink" title="(b) 局部变量"></a>(b) 局部变量</h3><p>作用域：仅仅在定义它的 begin end 中有效</p>
<p>应用在 begin end 中的第一句话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.声明</span><br><span class="line">    declare 变量名 类型;</span><br><span class="line">    declare 变量名 类型 default 值;</span><br><span class="line">2.赋值</span><br><span class="line">  方式一:通过 set 或 select</span><br><span class="line">    set 局部变量名&#x3D;值;或</span><br><span class="line">    set 局部变量名:&#x3D;值;或</span><br><span class="line">    select @局部变量名:&#x3D;值;</span><br><span class="line">  方式二:通过 select into</span><br><span class="line">    select 字段 into 局部变量名</span><br><span class="line">    from 表;</span><br><span class="line">3.使用</span><br><span class="line">    select 局部变量名;</span><br></pre></td></tr></table></figure>

<h3 id="c-对比"><a href="#c-对比" class="headerlink" title="(c) 对比"></a>(c) 对比</h3><table>
<thead>
<tr>
<th></th>
<th>作用域</th>
<th>定义和使用的位置</th>
<th>语法</th>
</tr>
</thead>
<tbody><tr>
<td>用户变量</td>
<td>当前会话</td>
<td>会话中的任何地方</td>
<td>必须加@符号</td>
</tr>
<tr>
<td>局部变量</td>
<td>BEGIN END中</td>
<td>只能在BEGIN END中，且为第一句话</td>
<td>一般不用加@符号，需要限定类型</td>
</tr>
</tbody></table>
<p>案例：声明两个变量并赋初值，求和，并打印</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#1.用户变量</span><br><span class="line">set @m &#x3D; 1;</span><br><span class="line">set @n &#x3D; 2;</span><br><span class="line">set @sum &#x3D; @m + @n;</span><br><span class="line">select @sum;</span><br><span class="line">#语法报错,需要使用在begin end中</span><br><span class="line">#2.局部变量</span><br><span class="line">declare m int default 1;</span><br><span class="line">declare n int default 2;</span><br><span class="line">declare sum int;</span><br><span class="line">set sum&#x3D;m+n;</span><br></pre></td></tr></table></figure>

<h1 id="三-存储过程和函数"><a href="#三-存储过程和函数" class="headerlink" title="三. 存储过程和函数"></a>三. 存储过程和函数</h1><p>类似 Java 中的方法</p>
<h2 id="A-存储过程"><a href="#A-存储过程" class="headerlink" title="(A) 存储过程"></a>(A) 存储过程</h2><h3 id="a-存储过程创建与调用"><a href="#a-存储过程创建与调用" class="headerlink" title="(a) 存储过程创建与调用"></a>(a) 存储过程创建与调用</h3><p>含义：一组预先编译好的 SQL 语句的集合，理解成批处理语句</p>
<p>好处：</p>
<ol>
<li>提高代码的重用性</li>
<li>简化操作</li>
<li>减少了编译次数并且减少了和数据库服务器的连接次数，提高了效率</li>
</ol>
<h4 id="1-创建语法"><a href="#1-创建语法" class="headerlink" title="(1) 创建语法"></a>(1) 创建语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create procedure 存储过程名(in|out|inout 参数名  参数类型,···)</span><br><span class="line">begin</span><br><span class="line">        存储过程体(一组合法的SQL语句)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<p>(1) 参数列表包括三部分</p>
<p>参数模式 参数名 参数类型</p>
<p>举例：</p>
<p>IN stuname VARCHAR(20)</p>
<p>参数模式：</p>
<p>IN：该参数可以作为输入，即该参数需要调入方传入值</p>
<p>OUT：该参数可以作为输出，即该参数可以作为返回值</p>
<p>INOUT：该参数即可以作为输入又可以作为输出，该参数既需要传入值，又可以返回值</p>
<p>(2) 如果存储过程体只有一句话，begin end 可以省略</p>
<p>存储过程体的每条 sql 语句的结尾必须加分号。存储过程的结尾可以使用 DELIMITER 重新设置</p>
<p>语法：</p>
<p>DELIMITER 结束标记</p>
<p>DELIMITER $</p>
<h4 id="2-调用语法"><a href="#2-调用语法" class="headerlink" title="(2) 调用语法"></a>(2) 调用语法</h4><p>CALL 存储过程名(实参列表)；</p>
<p>(1) 空参列表</p>
<p>案例：插入到 admin 表中 4 条记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#1.创建存储过程</span><br><span class="line">delimiter $</span><br><span class="line">create procedure myp1()</span><br><span class="line">begin</span><br><span class="line">        insert into admin(username,&#96;password&#96;)</span><br><span class="line">        values(&#39;john1&#39;,&#39;0000&#39;),(&#39;lili&#39;,&#39;0000&#39;),(&#39;rose&#39;,&#39;0000&#39;),(&#39;jack&#39;,&#39;0000&#39;);</span><br><span class="line">end $</span><br><span class="line">#2.调用</span><br><span class="line">call myp1()$</span><br></pre></td></tr></table></figure>

<p>(2) 创建带 in 模式参数的存储过程</p>
<p>案例 1：创建存储过程实现根据女神名，查询对应的男神信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#1.创建</span><br><span class="line">delimiter $</span><br><span class="line">create procedure myp2(in beautyName varchar(20))</span><br><span class="line">begin</span><br><span class="line">        select bo.*</span><br><span class="line">        from boys bo</span><br><span class="line">        right join beauty b</span><br><span class="line">        on bo.id&#x3D;b.&#96;boyfriend_id&#96;</span><br><span class="line">        where b.name&#x3D;beautyName;</span><br><span class="line">end $</span><br><span class="line">#2.调用</span><br><span class="line">call myp2(&#39;小昭&#39;);</span><br></pre></td></tr></table></figure>

<p>案例 2：创建存储过程实现用户是否登陆成功</p>
<p>思路：先创建存储过程来查询表中与输入信息相同的个数 (count(*))，然后为了将个数赋值给变量，声明了 int 类型的变量 result，然后用 if 语句来判断如果个数&gt;0，则输出成功。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure myp4(in username varchar(20),in password varchar(20))</span><br><span class="line">begin</span><br><span class="line">        #声明并初始化</span><br><span class="line">        declare result int default 0;</span><br><span class="line">        select count(*) into result #赋值 select into用法</span><br><span class="line">        from admin</span><br><span class="line">        #出现冲突时,使用表名.变量名的形式</span><br><span class="line">        where admin,username &#x3D; username</span><br><span class="line">        and admin.password &#x3D; PASSWORD;</span><br><span class="line">        #使用</span><br><span class="line">        select if(result&gt;0,&#39;成功&#39;,&#39;失败&#39;);</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">call myp4(&#39;张飞&#39;,&#39;8888&#39;);</span><br></pre></td></tr></table></figure>

<p>(3) 创建带 out 模式的存储过程</p>
<p>案例 1：根据女神名，返回对应的男神名</p>
<p>思路：查询后的结果利用 select into 参数名进行传递，然后调用时可以定义用户变量在 begin end 外面接收，然后输出即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure myp5(in beautyName varchar(20),out boyName varchar(20))</span><br><span class="line">begin</span><br><span class="line">        select bo.&#96;boyName&#96; into boyName</span><br><span class="line">        from &#96;boys&#96; bo</span><br><span class="line">        inner join &#96;beauty&#96; b</span><br><span class="line">        on bo.&#96;id&#96; &#x3D; b.&#96;boyfriend_id&#96;</span><br><span class="line">        where b.&#96;name&#96;&#x3D;beautyName;</span><br><span class="line">end $</span><br><span class="line">#调用</span><br><span class="line">set @bName;</span><br><span class="line">call myp5(&#39;小昭&#39;,@bName);</span><br><span class="line">select @bName;</span><br></pre></td></tr></table></figure>

<p>案例 2：根据女神名，返回对应的男神名和男神魅力值</p>
<p>注意：为了输出多个 OUT，需要在 select 写完后，再 INTO 后面加变量 1，变量 2。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure myp6(in beautyName varchar(20),OUT boyName varchar(20),OUT userCP int)</span><br><span class="line">begin</span><br><span class="line">        select bo.&#96;boyName&#96;,bo.&#96;userCP&#96; into boyName,userCP</span><br><span class="line">        from &#96;boys&#96; bo</span><br><span class="line">        inner join &#96;beauty&#96; b</span><br><span class="line">        on bo.&#96;id&#96; &#x3D; b.&#96;boyfriend_id&#96;</span><br><span class="line">        where b.&#96;name&#96;&#x3D;beautyName;</span><br><span class="line">end $</span><br><span class="line">call myp6(&#39;小昭&#39;,@bname,@userCP);</span><br><span class="line">select @bName,@userCP;</span><br></pre></td></tr></table></figure>

<p>(4) 创建带 inout 模式参数的存储过程</p>
<p>案例 1：传入 a 和 b 两个值，最终 a 和 b 都翻倍并返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure myp7(inout a int, inout b int)</span><br><span class="line">begin</span><br><span class="line">        set a&#x3D;a*2;</span><br><span class="line">        set b&#x3D;b*2;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">set @m&#x3D;10;</span><br><span class="line">set @n&#x3D;20;</span><br><span class="line">call myp7(@m,@n);</span><br><span class="line">select @m,@n;</span><br></pre></td></tr></table></figure>

<h3 id="b-存储过程删除"><a href="#b-存储过程删除" class="headerlink" title="(b) 存储过程删除"></a>(b) 存储过程删除</h3><p>语法：drop procedure 存储过程名</p>
<h3 id="c-查看存储过程的信息"><a href="#c-查看存储过程的信息" class="headerlink" title="(c) 查看存储过程的信息"></a>(c) 查看存储过程的信息</h3><p>show create procedure 存储过程名</p>
<h3 id="d-存储过程练习"><a href="#d-存储过程练习" class="headerlink" title="(d) 存储过程练习"></a>(d) 存储过程练习</h3><p>(1) 创建存储过程实现传入用户名和密码，插入到 admin 表中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure test_pro1(in username varchar(20), in password varchar(20))</span><br><span class="line">begin</span><br><span class="line">        insert into admin(admin.username,admin.&#96;password&#96;)</span><br><span class="line">        values(username,password);</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">call test_pro1(&#39;admin&#39;,&#39;0000&#39;);</span><br></pre></td></tr></table></figure>

<p>(2) 创建存储过程或函数实现传入女神编号，返回女神名称和女神电话</p>
<p>有复制，用 select 字段 into 变量名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure test_pro2(in beautyID int,out beautyName varchar(20),out beautyPhone varchar(20))</span><br><span class="line">begin</span><br><span class="line">        select &#96;name&#96;,&#96;phone&#96; into beautyName,beautyPhone</span><br><span class="line">        from &#96;beauty&#96;</span><br><span class="line">        where id&#x3D;beautyID;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">call test_pro2(12,@name,@phone);</span><br><span class="line">select @name,@phone;</span><br></pre></td></tr></table></figure>

<p>(3) 创建存储过程或函数实现传入两个女神生日，返回大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure test_pro3(in birth1 datetime, in birth2 datetime, out result int)</span><br><span class="line">begin</span><br><span class="line">        select datediff(birth1,birth2) into result;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">call test_pro3(&#39;1988-1-1&#39;,now(),@result);</span><br><span class="line">select @result;</span><br></pre></td></tr></table></figure>

<p>(4) 创建存储过程或函数传入一个日期，格式化成xx年xx月xx日并返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure test_pro4(in mydate datetime, out str varchar(20))</span><br><span class="line">begin</span><br><span class="line">        select date_format(mydate,&#39;%y年%m月%d日&#39;) into str;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">call test_pro4(now(),@str);</span><br><span class="line">select @str;</span><br></pre></td></tr></table></figure>

<p>(5) 创建存储过程或函数传入女神名称，返回：女神 and 男神 格式的字符串</p>
<p>如：传入 小昭</p>
<p>返回：小昭 and 张无忌</p>
<p>思路：正常查询，其中字符串拼接使用 concat 函数，中间用逗号隔开，输出存入变量，查询用右外连接，加上筛选条件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure test_pro5(in beautyName varchar(20), out str varchar(50))</span><br><span class="line">begin</span><br><span class="line">        select concat(beautyName,&#39; and &#39;,boyName) into str</span><br><span class="line">        from boys bo</span><br><span class="line">        right join beauty b</span><br><span class="line">        on bo.id&#x3D;b.boyfriend_id</span><br><span class="line">        where b.name&#x3D;beautyName;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">call test_pro5(&#39;小昭&#39;,@str);</span><br><span class="line">select @str;</span><br></pre></td></tr></table></figure>

<p>但是这样的话，当 boyName 为 null 的时候，拼接在一起也是 null，因此最好使用 ifnull 来进行判断，只要有为空可能的字段，要是跟其他字符串拼接或者要使用它，最好加上 ifnull 判断。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure test_pro5(in beautyName varchar(20), out str varchar(50))</span><br><span class="line">begin</span><br><span class="line">        select concat(beautyName,&#39; and &#39;,ifnull(boyName,&#39;null&#39;)) into str</span><br><span class="line">        from boys bo</span><br><span class="line">        right join beauty b</span><br><span class="line">        on bo.id&#x3D;b.boyfriend_id</span><br><span class="line">        where b.name&#x3D;beautyName;</span><br><span class="line">end $</span><br></pre></td></tr></table></figure>

<p>(6) 创建存储过程与函数，根据传入的条目数和起始索引，查询 beauty 表的记录</p>
<p>其中用到了分页，limit [offset]，size</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure test_pro6(in size int, in startIndex int)</span><br><span class="line">begin</span><br><span class="line">        select * from beauty limit startIndex,size;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">call test_pro6(3,5);</span><br></pre></td></tr></table></figure>

<h2 id="B-函数"><a href="#B-函数" class="headerlink" title="(B) 函数"></a>(B) 函数</h2><p>与存储过程的区别是：</p>
<ul>
<li>存储过程：可以有 0 个返回，也可以有多个返回，适合做批量插入，批量更新</li>
<li>函数：有且仅有 1 个返回，适合做处理数据后返回一个结果</li>
</ul>
<h3 id="a-函数创建"><a href="#a-函数创建" class="headerlink" title="(a) 函数创建"></a>(a) 函数创建</h3><p>(1) 创建语法</p>
<p>create function 函数名(参数列表) <strong>returns</strong> 返回类型</p>
<p>begin</p>
<p>函数体</p>
<p>end</p>
<p>注意：</p>
<ul>
<li>参数列表包含两部分，参数名 参数类型</li>
<li>函数体：肯定会有 return 语句，如果没有会报错，如果 return 语句不放在函数体最后不报错，但不建议</li>
<li>函数体中仅有一句话，可以省略 begin end</li>
<li>使用 delimiter 语句设置结束标记</li>
</ul>
<h3 id="b-函数调用"><a href="#b-函数调用" class="headerlink" title="(b) 函数调用"></a>(b) 函数调用</h3><p>执行语句并显示返回值</p>
<p>语法：</p>
<p>select 函数名(参数列表)</p>
<p>(1) 无参有返回</p>
<p>案例：返回公司的员工个数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create function myf1() returns int</span><br><span class="line">begin</span><br><span class="line">        declare c int default 0; #定义变量</span><br><span class="line">        select count(*) into c #赋值</span><br><span class="line">        from employees;</span><br><span class="line">        return c;</span><br><span class="line">end $</span><br><span class="line">#调用</span><br><span class="line">select myf1();</span><br></pre></td></tr></table></figure>

<p>(2) 有参有返回</p>
<p>案例 1：根据员工名，返回它的工资</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create function myf2(empName varchar(20)) returns double</span><br><span class="line">begin</span><br><span class="line">        set @sal&#x3D;0; #定义用户变量</span><br><span class="line">        select salary into @sal #赋值</span><br><span class="line">        from employees</span><br><span class="line">        where last_name &#x3D; empName;</span><br><span class="line">        return @sal; #返回值</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">select myf2(&#39;Kochhar&#39;);</span><br></pre></td></tr></table></figure>

<p>案例 2：根据部门名，返回该部门的平均工资</p>
<p>规律：</p>
<ul>
<li>记得写 returns 变量 类型</li>
<li>在 begin end 中定义变量 (declare sal double) or (set @sal double)</li>
<li>利用 select 字段 into 变量赋值</li>
<li>最后 return 变量。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create function myf3(depName varchar(20)) returns double</span><br><span class="line">begin</span><br><span class="line">        #定义返回值</span><br><span class="line">        declare sal double;</span><br><span class="line">        select avg(salary) into sal</span><br><span class="line">        from employees e</span><br><span class="line">        join departments d on e.&#96;department_id&#96;&#x3D;d.&#96;department_id&#96;</span><br><span class="line">        where d.&#96;department_name&#96;&#x3D;depName;</span><br><span class="line">        return sal;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">select myf3(&#39;IT&#39;);</span><br></pre></td></tr></table></figure>

<h3 id="c-查看函数"><a href="#c-查看函数" class="headerlink" title="(c) 查看函数"></a>(c) 查看函数</h3><p>语法</p>
<p>show create function 函数名;</p>
<h3 id="d-删除函数"><a href="#d-删除函数" class="headerlink" title="(d) 删除函数"></a>(d) 删除函数</h3><p>语法</p>
<p>drop function 函数名;</p>
<h3 id="e-函数练习"><a href="#e-函数练习" class="headerlink" title="(e) 函数练习"></a>(e) 函数练习</h3><p>案例：创建函数，实现传入两个 float，返回二者之和</p>
<p>这里给变量赋值，可以使用 set 变量=语句，也可以使用 select 语句 into 变量名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create function myf4(num1 float,num2 float) returns float</span><br><span class="line">begin</span><br><span class="line">        declare num3 float;</span><br><span class="line">        set num3 &#x3D; num1 + num2;</span><br><span class="line">        return num3;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">select myf4(1,2);</span><br></pre></td></tr></table></figure>

<h1 id="四-流程控制结构"><a href="#四-流程控制结构" class="headerlink" title="四. 流程控制结构"></a>四. 流程控制结构</h1><ul>
<li>顺序结构：程序从上往下依次执行</li>
<li>分支结构：程序从两条或多条路径中选择一条去执行</li>
<li>循环结构：程序在满足一定条件的基础上，重复执行一段代码</li>
</ul>
<h2 id="A-分支结构"><a href="#A-分支结构" class="headerlink" title="(A) 分支结构"></a>(A) 分支结构</h2><h3 id="a-IF-函数"><a href="#a-IF-函数" class="headerlink" title="(a) IF 函数"></a>(a) IF 函数</h3><p>功能：实现简单的双分支</p>
<p>select if(表达式1, 表达式2, 表达式3)</p>
<p>执行顺序：如果 if 函数成立，则 if 函数返回表达式 2 的值，否则返回表达式 3 的值</p>
<p>应用在任何地方</p>
<h3 id="b-CASE-结构"><a href="#b-CASE-结构" class="headerlink" title="(b) CASE 结构"></a>(b) CASE 结构</h3><p>情况 1：类似于 java 中的 switch 语句，一般用于实现等值判断</p>
<p>语法：</p>
<p>case 变量|表达式|字段</p>
<p>when 要判断的值 then 返回的值 1 或语句 1 [;]</p>
<p>when 要判断的值 then 返回的值 2 或语句 2 [;]</p>
<p>···</p>
<p>else 要返回的值 n 或语句 n [;]</p>
<p>end [case;]</p>
<p>情况 2：类似于 java 中的多重 if 语句，一般用于实现区间判断</p>
<p>case</p>
<p>when 要判断的条件 1 then 返回的值 1 或语句 1 [;]</p>
<p>when 要判断的条件 2 then 返回的值 2 或语句 2 [;]</p>
<p>···</p>
<p>else 要返回的值 n 或语句 n [;]</p>
<p>end [case;]</p>
<p>特点：</p>
<ol>
<li>可以作为表达式，嵌套在其他语句中使用，可以放在任何地方，begin end 中或外面可以作为<strong>独立的语句</strong>使用，只能放在 begin end 中</li>
<li>如果 when 中的值满足或条件成立，则执行对应的 then 后面的语句，并且结束 case 如果都不满足，则执行 else 中的语句或值</li>
<li>else 可以省略，如果 else 省略了，并且所有的 when 条件都不满足，则返回 null</li>
</ol>
<p>案例：创建存储过程，根据传入的成绩来显示等级，如传入成绩：90-100，显示 A；80-90，显示 B；60-80，显示 C；否则显示 D</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure test_case(in score int)</span><br><span class="line">begin</span><br><span class="line">        case</span><br><span class="line">        when score&gt;&#x3D;90 and score&lt;&#x3D;100 then select &#39;A&#39;;</span><br><span class="line">        when score&gt;&#x3D;80 then select &#39;B&#39;;</span><br><span class="line">        when score&gt;&#x3D;60 then select &#39;C&#39;;</span><br><span class="line">        else select &#39;D&#39;;</span><br><span class="line">        end case;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">call test_case(55);</span><br></pre></td></tr></table></figure>

<h3 id="c-IF-结构"><a href="#c-IF-结构" class="headerlink" title="(c) IF 结构"></a>(c) IF 结构</h3><p>功能：实现多重分支</p>
<p>语法：</p>
<p>if 条件1 then 语句1;</p>
<p>elseif 条件2 then 语句2;</p>
<p>···</p>
<p>[else 语句n;]</p>
<p>end if;</p>
<p>应用场景：应用在 begin end 中</p>
<p>案例：根据传入的成绩，来显示等级，比如传入成绩：90-100，返回 A；80-90，返回 B；60-80，返回 C；否则返回 D</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create function test_if(score int) returns char</span><br><span class="line">begin</span><br><span class="line">        if score&gt;&#x3D;90 and score&lt;&#x3D;100 then return &#39;A&#39;;</span><br><span class="line">        elseif score&gt;&#x3D;80 then return &#39;B&#39;;</span><br><span class="line">        elseif score&gt;&#x3D;60 then return &#39;C&#39;;</span><br><span class="line">        else return &#39;D&#39;;</span><br><span class="line">        end if;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">select test_if(86);</span><br></pre></td></tr></table></figure>

<h2 id="B-循环结构"><a href="#B-循环结构" class="headerlink" title="(B) 循环结构"></a>(B) 循环结构</h2><p>分类：while，loop，repeat</p>
<p>循环控制：</p>
<p>iterate 类似于 continue，继续，结束本次循环，继续下一次</p>
<p>leave 类似于 break，跳出，结束当前所在的循环</p>
<h3 id="a-while"><a href="#a-while" class="headerlink" title="(a) while"></a>(a) while</h3><p>语法：</p>
<p>[标签: ] while 循环条件 do</p>
<p>循环体;</p>
<p>end while [标签];</p>
<h3 id="b-loop"><a href="#b-loop" class="headerlink" title="(b) loop"></a>(b) loop</h3><p>语法：</p>
<p>[标签: ] loop</p>
<p>循环体;</p>
<p>end loop [标签];</p>
<p>可以用来模拟简单的死循环</p>
<h3 id="c-repeat"><a href="#c-repeat" class="headerlink" title="(c) repeat"></a>(c) repeat</h3><p>类似于 do while，至少执行一次</p>
<p>语法：</p>
<p>[标签: ] repeat</p>
<p>循环体;</p>
<p>until 结束循环的条件</p>
<p>end repeat [标签];</p>
<h3 id="d-循环的使用"><a href="#d-循环的使用" class="headerlink" title="(d) 循环的使用"></a>(d) 循环的使用</h3><p>没有添加循环控制语句</p>
<p>案例：批量插入，根据次数插入到 admin 表中多条记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure pro_while1(in insertCount int)</span><br><span class="line">begin</span><br><span class="line">        #定义循环变量i,int类型初始值为1</span><br><span class="line">        declare i int default 1;</span><br><span class="line">        while i&lt;&#x3D;insertCount do</span><br><span class="line">                insert into admin(username,&#96;password&#96;) values(concat(&#39;rose&#39;,i),&#39;666&#39;);</span><br><span class="line">                set i&#x3D;i+1;</span><br><span class="line">        end while;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">call pro_while1(10);</span><br></pre></td></tr></table></figure>

<p>添加 leave 语句</p>
<p>案例：批量插入，根据次数插入到 admin 表中多条记录，如果次数 &gt;20 则停止</p>
<p>这里配合了 IF 结构来使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure test_while1(in insertCount int)</span><br><span class="line">begin</span><br><span class="line">        declare i int default 1;</span><br><span class="line">        a:while i&lt;&#x3D;insertCount do</span><br><span class="line">                insert into admin(username,&#96;password&#96;) values(concat(&#39;hua&#39;,i),&#39;0000&#39;);</span><br><span class="line">                if i&gt;&#x3D;20 then leave a;</span><br><span class="line">                end if;</span><br><span class="line">                set i&#x3D;i+1;</span><br><span class="line">        end while a;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">call test_while1(30);</span><br></pre></td></tr></table></figure>

<p>添加 iterate 语句</p>
<p>案例：批量插入，根据次数插入到 admin 表中多条记录，只插入偶数次</p>
<p>思路：在不为偶数次的时候，iterate 退出即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure test_while2(in insertCount int)</span><br><span class="line">begin</span><br><span class="line">        declare i int default 0;</span><br><span class="line">        a:while i&lt;&#x3D;insertCount do</span><br><span class="line">                set i&#x3D;i+1;</span><br><span class="line">                if mod(i,2)!&#x3D;0 then iterate a;</span><br><span class="line">                end if;</span><br><span class="line">                insert into admin(username,&#96;password&#96;) values(concat(&#39;xi&#39;,i),&#39;0000&#39;);</span><br><span class="line">        end while a;</span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">call test_while2(20);</span><br></pre></td></tr></table></figure>

<h1 id="五-重要函数"><a href="#五-重要函数" class="headerlink" title="五. 重要函数"></a>五. 重要函数</h1><ul>
<li><p><strong>IFNULL [重要]</strong></p>
<p>IFNULL (变量名，常量)</p>
<p>如果变量为空，则用常量代替。</p>
<p>只要有为空可能的字段，要是跟其他字符串拼接或者要使用它，最好加上 IFNULL 判断。</p>
</li>
<li><p><strong>SET NAMES gbk;</strong></p>
<p>要是字符集报错，一般需要重新设置字符集</p>
</li>
<li><p><strong>DATEDIFF (time1,time2)</strong></p>
<p>返回两个 datetime 类型的时间差，返回为整数</p>
</li>
<li><p><strong>NOW()</strong></p>
<p>返回现在的时间，datetime 类型</p>
</li>
<li><p><strong>CONCAT()</strong></p>
<p>拼接字符串，中间用逗号隔开</p>
</li>
<li><p><strong>LIMIT</strong></p>
<p>limit [offset]，size</p>
<p>用来分页，其中 offset 为开始的地方，从 0 开始，size 表示数据量。</p>
</li>
</ul>
<h1 id="六-牛客网题目"><a href="#六-牛客网题目" class="headerlink" title="六. 牛客网题目"></a>六. 牛客网题目</h1><p>(1) 查询当前薪水 (to_date=’9999-01-01’) 排名第二多的员工编号 emp_no，薪水 salary，last_name 以及 first_name，不准使用 order by</p>
<p>思路：不能使用 order by，就只能先找到最高薪水，然后将其排出 salary 的选择之中 (not in)，然后在剩下的工资中选择最大的，即为总体第二大的，用到的是内连接 +where 子查询的嵌套。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select e.emp_no,max(salary) salary,e.last_name,e.first_name</span><br><span class="line">from employees e</span><br><span class="line">join salaries s</span><br><span class="line">on e.emp_no&#x3D;s.emp_no</span><br><span class="line">where s.to_date&#x3D;&#39;9999-01-01&#39;</span><br><span class="line">and s.salary not in (</span><br><span class="line">    select max(salary)</span><br><span class="line">    from salaries</span><br><span class="line">    where to_date&#x3D;&#39;9999-01-01&#39;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>(2) 查找员工编号 emp_no 为 10001 其自入职以来的薪水 salary 涨幅值 growth</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table &#96;salaries&#96; (</span><br><span class="line">&#96;emp_no&#96; int(11) not null,</span><br><span class="line">&#96;salary&#96; int(11) not null,</span><br><span class="line">&#96;from_date&#96; date not null,</span><br><span class="line">&#96;to_date&#96; date not null,</span><br><span class="line">primary key (&#96;emp_no&#96;,&#96;from_date&#96;));</span><br></pre></td></tr></table></figure>

<p>将工资按照时间排序，找出第一个和最后一个，然后二者相减。考察的是 <strong>select的子句查询</strong>。最外层的 select 不用加 from 表，因为用不到。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">(select salary from salaries where emp_no &#x3D; 10001 order by from_date desc limit 1)</span><br><span class="line">- (select salary from salaries where emp_no &#x3D; 10001 order by from_date asc limit 1)</span><br><span class="line">as growth;</span><br></pre></td></tr></table></figure>

<h1 id="七-JDBC"><a href="#七-JDBC" class="headerlink" title="七. JDBC"></a>七. JDBC</h1><p>Java DataBase Connectivity</p>
<p>将 Java 程序与数据库连接在一起。JDBC 统一接口，java 程序与 JDBC 通信，JDBC 通过不同驱动连接不同的数据库，相当于在 java 和数据库之间加了一层。一层不行就加两层。</p>
<h2 id="A-Driver-Manager"><a href="#A-Driver-Manager" class="headerlink" title="(A) Driver Manager"></a>(A) Driver Manager</h2><p>就是一个类库。通过 Manager 连接不同的数据库</p>
<h2 id="B-JDBC-使用"><a href="#B-JDBC-使用" class="headerlink" title="(B) JDBC 使用"></a>(B) JDBC 使用</h2><ol>
<li>加载对应数据库的驱动</li>
<li>根据指定的 URL 建立连接</li>
<li>通过连接过去语句对象</li>
<li>在语句对象中写入要执行的语句，获取结果集</li>
<li>遍历结果集，获取数据</li>
<li>关闭资源</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.加载驱动</span></span><br><span class="line">Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line"><span class="comment">//2.通过Manager创建连接</span></span><br><span class="line">String url = <span class="string">&quot;jdbc:mysql://localhost/girls?user=root&amp;password=密码&amp;serverTimezone=UTC&quot;</span>;</span><br><span class="line">Connection conn = DriverManager.getConnection(url);</span><br><span class="line"><span class="comment">//3.创建语句对象</span></span><br><span class="line">Statement statement = conn.createStatement();</span><br><span class="line"><span class="comment">//4.用语句对象去执行语句</span></span><br><span class="line">ResultSet resultSet = statement.executeQuery(<span class="string">&quot;select * from admin&quot;</span>);</span><br><span class="line"><span class="comment">//5.获取结果集中内容</span></span><br><span class="line"><span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">    System.out.println(resultSet.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//6.关闭资源</span></span><br><span class="line">resultSet.close();</span><br><span class="line">statement.close();</span><br><span class="line">conn.close();</span><br></pre></td></tr></table></figure>

<p>使用技巧：语句对象中执行的 sql 语句先在客户端执行，看是否正确；结果集的指针指向第一条记录的上面，因此 next 后才是第一条语句。</p>
<p>完善的写法如下，在加载的时候，进行 try，catch，在创建的时候，进行 try，catch，在关闭的时候，进行判断是否为空，然后在 finally 中关闭。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.加载驱动</span></span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2.通过Manager创建连接</span></span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost/girls?   user=root&amp;password=qkxzs&amp;serverTimezone=UTC&quot;</span>;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//3.创建语句对象</span></span><br><span class="line">        Statement statement = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//4.用语句对象去执行语句</span></span><br><span class="line">        ResultSet resultSet = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DriverManager.getConnection(url);</span><br><span class="line">            statement = conn.createStatement();</span><br><span class="line">            resultSet = statement.executeQuery(<span class="string">&quot;select * from admin&quot;</span>);</span><br><span class="line">            <span class="comment">//5.获取结果集中内容</span></span><br><span class="line">            <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">                System.out.println(resultSet.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//6.关闭资源</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (resultSet != <span class="keyword">null</span>)</span><br><span class="line">                    resultSet.close();</span><br><span class="line">                <span class="keyword">if</span> (statement != <span class="keyword">null</span>)</span><br><span class="line">                    statement.close();</span><br><span class="line">                <span class="keyword">if</span> (conn != <span class="keyword">null</span>)</span><br><span class="line">                    conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>如果是传入的参数是不确定的，如 sql 语句中大于某个字段的值一开始不确定，那么 sql 语句中用占位符 ? 先表示，然后使用 PreparedStatement，将占位符 ? 进行替换，再进行查询。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.创建语句对象</span></span><br><span class="line">      PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">      <span class="comment">//4、用语句对象去执行语句</span></span><br><span class="line">      ResultSet resultSet = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">int</span> id = <span class="number">10</span>;</span><br><span class="line">      String sql = <span class="string">&quot;select * from admin where id &gt; ?&quot;</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          conn = DriverManager.getConnection(url);</span><br><span class="line">          ps = conn.prepareStatement(sql);</span><br><span class="line">          ps.setInt(<span class="number">1</span>,id);<span class="comment">//替换在第一个问号处</span></span><br><span class="line">          resultSet = ps.executeQuery();</span><br><span class="line">          <span class="comment">//5.获取结果集中内容</span></span><br><span class="line">          <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">              System.out.println(resultSet.getInt(<span class="string">&quot;id&quot;</span>)+<span class="string">&quot; &quot;</span>+resultSet.getString(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>如果是 sql 语句为 insert，update，delete 这种更新的语句，则不需要获取结果集，而且执行语句时使用 statement.executeUpdate 即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Statement statement = <span class="keyword">null</span>;</span><br><span class="line">        String sql = <span class="string">&quot;insert into admin values(64,&#x27;jdbc&#x27;,&#x27;0001&#x27;)&quot;</span>;</span><br><span class="line">        <span class="comment">//String sql = &quot;update admin set username=&#x27;jdbc2&#x27; where id = 64&quot;;</span></span><br><span class="line">        <span class="comment">//String sql = &quot;delete from admin where id = 64&quot;;</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DriverManager.getConnection(url);</span><br><span class="line">            statement = conn.createStatement();</span><br><span class="line">            statement.executeUpdate(sql);<span class="comment">//insert update delete</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>如果是更新的数据不确定，同样使用 PreparedStatement 即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.创建语句对象</span></span><br><span class="line">      PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">      String sql = <span class="string">&quot;insert into admin values(?,?,?)&quot;</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          conn = DriverManager.getConnection(url);</span><br><span class="line">          ps = conn.prepareStatement(sql);</span><br><span class="line">          ps.setInt(<span class="number">1</span>,<span class="number">64</span>);</span><br><span class="line">          ps.setString(<span class="number">2</span>,<span class="string">&quot;jdbc3&quot;</span>);</span><br><span class="line">          ps.setString(<span class="number">3</span>,<span class="string">&quot;0002&quot;</span>);</span><br><span class="line">          ps.executeUpdate();<span class="comment">//insert update delete</span></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h2 id="C-事务"><a href="#C-事务" class="headerlink" title="(C) 事务"></a>(C) 事务</h2><p>步骤：</p>
<ol>
<li>connection 关闭自动提交</li>
<li>一组 sql 语句</li>
<li>connection 提交</li>
<li>在 catch 中，有异常时回滚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.加载驱动</span></span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2.通过Manager创建连接</span></span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost/test?user=root&amp;password=qkxzs&amp;serverTimezone=UTC&quot;</span>;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//3.创建语句对象</span></span><br><span class="line">        Statement statement = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DriverManager.getConnection(url);</span><br><span class="line">            statement = conn.createStatement();</span><br><span class="line">            conn.setAutoCommit(<span class="keyword">false</span>);<span class="comment">//关闭自动提交</span></span><br><span class="line">            statement.executeUpdate(<span class="string">&quot;update account set balance= 50 where id = 1&quot;</span>);</span><br><span class="line">            statement.executeUpdate(<span class="string">&quot;update account set balance= 150 where id = 2&quot;</span>);</span><br><span class="line">            conn.commit();<span class="comment">//手动提交</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.rollback();<span class="comment">//有异常时回滚</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//6.关闭资源</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (statement != <span class="keyword">null</span>)</span><br><span class="line">                    statement.close();</span><br><span class="line">                <span class="keyword">if</span> (conn != <span class="keyword">null</span>)</span><br><span class="line">                    conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="D-快捷键"><a href="#D-快捷键" class="headerlink" title="(D) 快捷键"></a>(D) 快捷键</h2><p><strong>MySQL 客户端</strong></p>
<ul>
<li>F12 将选中语句自动换行</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/MySQL/" rel="tag"># MySQL</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/11/06/MySQL02/" rel="prev" title="MySQL笔记(零二)：DML·DDL·TCL语言">
      <i class="fa fa-chevron-left"></i> MySQL笔记(零二)：DML·DDL·TCL语言
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/11/22/MySQL04/" rel="next" title="MySQL笔记(零四)：MySQL高级">
      MySQL笔记(零四)：MySQL高级 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Minwei Chen</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/next-boot.js"></script>


  















  

  

  

</body>
</html>
